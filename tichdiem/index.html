<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tra c·ª©u ƒêi·ªÉm √äƒë√™ Bu√¥n L√†ng</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Oswald:wght@500&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    /* ------------------------------------- */
    /* I. THI·∫æT K·∫æ CH·ª¶ ƒê·∫†O - BI·∫æN M√ÄU */
    /* ------------------------------------- */
    :root {
      /* Palette T√¢y Nguy√™n: g·ªó n√¢u ‚Äì cacao ‚Äì ƒë·∫•t ƒë·ªè bazan ‚Äì ƒëen ƒë√° ‚Äì tr·∫Øng kem */
      --wood-dark: #4a2e1f; /* ƒêen ƒë√°, n√¢u ƒë·∫≠m */
      --wood-medium: #7a4f32; /* N√¢u g·ªó trung b√¨nh */
      --wood-light: #d7b89c; /* N√¢u g·ªó nh·∫°t, kem */
      --earth-red: #8a3f2d; /* ƒê·∫•t ƒë·ªè bazan */
      --cream: #f6f1e9; /* Tr·∫Øng kem */
      --cacao: #5a3a26; /* Cacao/C√† ph√™ */
      
      /* Bi·∫øn chung */
      --border-radius-large: 22px;
      --border-radius-medium: 14px;
      --shadow-soft: 0 4px 10px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.5) inset; /* iOS soft neu-morphism */
      --shadow-lift: 0 10px 20px rgba(0, 0, 0, 0.15);
      --transition-time: 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    /* ------------------------------------- */
    /* II. FONT V√Ä N·ªÄN CHUNG */
    /* ------------------------------------- */
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--cream);
      color: var(--wood-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 414px; /* Layout mobile 360‚Äì414px */
      padding: 0 20px 40px;
      box-sizing: border-box;
    }

    h2, h3 {
      font-family: 'Oswald', sans-serif;
      text-transform: uppercase;
      font-weight: 500;
      color: var(--earth-red);
    }
    
    /* ------------------------------------- */
    /* III. HEADER & LOGO */
    /* ------------------------------------- */
    .header {
      padding: 25px 20px;
      text-align: center;
      opacity: 0;
      transform: translateY(-20px);
      animation: fadeIn 0.8s forwards 0.2s; /* Animation fade-in */
    }

    .logo {
      font-family: 'Oswald', sans-serif;
      font-size: 32px;
      letter-spacing: 2px;
      font-weight: bold;
      color: var(--wood-dark);
      background-color: rgba(255, 255, 255, 0.3); /* N·ªÅn trong su·ªët nh·∫π */
      padding: 10px 20px;
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.5);
      display: inline-block;
    }
    .logo span {
        color: var(--earth-red);
        font-size: 0.7em;
        display: block;
        letter-spacing: 0.5px;
        margin-top: -5px;
    }

    /* ------------------------------------- */
    /* IV. KH·ªêI NH·∫¨P S·ªê ƒêI·ªÜN THO·∫†I */
    /* ------------------------------------- */
    .query-box {
      background: rgba(255, 255, 255, 0.8);
      padding: 25px;
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-lift);
      backdrop-filter: blur(5px);
      border: 1px solid var(--wood-light);
      margin-bottom: 25px;
      opacity: 0;
      transform: translateY(20px);
      animation: slideUp 0.8s forwards 0.4s;
    }

    .input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .input-wrapper {
      position: relative;
      flex-grow: 1;
    }

    input[type="text"] {
      padding: 15px 15px 15px 45px;
      border: 1px solid var(--wood-light);
      border-radius: var(--border-radius-medium);
      width: 100%;
      font-size: 16px;
      box-sizing: border-box;
      background-color: var(--cream);
      color: var(--wood-dark);
      transition: all 0.3s;
    }
    
    .input-wrapper i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--wood-medium);
      font-size: 18px;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--earth-red);
      box-shadow: 0 0 0 3px rgba(138, 63, 45, 0.2); /* focus glow m√†u n√¢u ƒë·∫•t */
    }

    /* N√∫t Tra C·ª©u ƒêi·ªÉm */
    .buonme-button {
      padding: 15px 20px;
      background: linear-gradient(135deg, var(--cacao) 0%, var(--wood-medium) 100%); /* Gradient g·ªó */
      color: var(--cream);
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: var(--shadow-soft);
      transition: var(--transition-time);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }
    
    .buonme-button:active {
        transform: scale(0.95); /* iOS spring effect (scale) */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    /* Button ripple effect */
    .buonme-button .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple 0.6s linear;
      background-color: rgba(255, 255, 255, 0.4);
    }
    
    /* N√∫t ƒê·ªïi Ngay (Exchange Button) */
    .exchange-button {
        padding: 10px 15px;
        background-color: var(--earth-red);
        color: var(--cream);
        border: none;
        border-radius: 16px;
        font-weight: bold;
        transition: transform 0.2s, opacity 0.2s;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .exchange-button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
        box-shadow: none;
    }
    .exchange-button:active {
        transform: scale(0.95);
    }


    /* ------------------------------------- */
    /* V. KH·ªêI K·∫æT QU·∫¢ & L·ªäCH S·ª¨ */
    /* ------------------------------------- */
    #loyaltyPointsResult {
      margin-top: 0;
      padding: 25px;
      border-radius: var(--border-radius-large);
      min-height: 50px;
      text-align: left;
      line-height: 1.6;
      font-size: 16px;
      font-weight: 500;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s;
    }
    
    .status-card {
        box-shadow: var(--shadow-lift);
        border-left: 5px solid;
    }

    .info {
      background-color: #fff3cd; 
      color: #856404;
      border-left-color: #ffc107;
      border: 1px solid #ffc107;
    }
    .error {
      background-color: #f8d7da; 
      color: #721c24;
      border-left-color: #dc3545;
      border: 1px solid #dc3545;
    }
    .success {
      background: linear-gradient(180deg, var(--wood-light), #fff) ;
      color: var(--wood-dark);
      border-left-color: var(--earth-red);
      border: 1px solid var(--wood-light);
    }
    
    /* Th·∫ª K·∫øt Qu·∫£ (Success Card) */
    .result-card-inner {
        display: flex;
        gap: 20px;
        align-items: center;
        text-align: center;
        flex-direction: column;
    }
    
    .result-icon {
        background-color: var(--earth-red);
        color: var(--cream);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        box-shadow: var(--shadow-soft);
        flex-shrink: 0;
    }
    
    .result-details {
        text-align: center;
    }

    .loyalty-points-display {
      font-size: 3.2em;
      font-family: 'Oswald', sans-serif;
      color: var(--earth-red);
      font-weight: bold;
      line-height: 1;
      margin: 10px 0;
    }
    
    .member-level {
        font-size: 1em;
        font-style: italic;
        background-color: var(--cacao);
        color: var(--cream);
        padding: 5px 10px;
        border-radius: 10px;
        display: inline-block;
        margin-top: 5px;
        font-weight: normal;
    }

    /* L·ªãch S·ª≠ T√≠ch ƒêi·ªÉm */
    #historySection {
        margin-top: 40px;
        opacity: 0;
        transform: translateY(20px);
    }

    .history-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .history-item {
        background-color: #fff;
        padding: 15px;
        border-radius: var(--border-radius-medium);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
        border-left: 3px solid var(--wood-medium);
        opacity: 0; /* Cho animation stagger */
    }

    .history-icon {
        color: var(--earth-red);
        font-size: 20px;
        flex-shrink: 0;
    }

    .history-details {
        flex-grow: 1;
    }

    .history-details p {
        margin: 0;
        line-height: 1.4;
    }
    
    .history-details .date {
        font-size: 0.85em;
        color: #888;
    }

    .history-points {
        font-weight: bold;
        color: var(--wood-medium);
        flex-shrink: 0;
    }
    
    .history-points.plus {
        color: #4CAF50;
    }
    
    /* VI. DANH S√ÅCH ƒê·ªîI ƒêI·ªÇM (C√îNG CHI√äNG SECTION) */
    #exchangeSection {
        margin-top: 40px;
        opacity: 0;
        transform: translateY(20px);
    }

    .exchange-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .exchange-card {
        background: linear-gradient(135deg, var(--wood-light), #fff);
        border-radius: var(--border-radius-large);
        padding: 20px;
        box-shadow: var(--shadow-lift);
        text-align: center;
        border: 1px solid var(--wood-medium);
        opacity: 0; /* Cho animation scaleIn */
        transform: scale(0.8);
    }

    .exchange-card-icon {
        color: var(--earth-red);
        font-size: 40px;
        margin-bottom: 10px;
    }

    .exchange-card h4 {
        margin: 0 0 5px 0;
        color: var(--wood-dark);
        font-size: 1.2em;
    }

    .exchange-card p {
        margin: 0 0 15px 0;
        font-size: 0.9em;
        color: #666;
    }

    .points-required {
        font-family: 'Oswald', sans-serif;
        font-size: 1.5em;
        color: var(--cacao);
        margin-bottom: 15px;
        font-weight: bold;
    }
    
    .points-required i {
        color: var(--earth-red);
        margin-right: 5px;
    }

    /* VII. FOOTER */
    .footer {
      padding: 20px 20px 40px;
      text-align: center;
      font-size: 0.85em;
      color: var(--cacao);
    }

    /* VIII. KEYFRAMES ANIMATION */
    @keyframes fadeIn {
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes scaleIn {
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      20%, 80% { transform: translateY(-3px); }
      40%, 60% { transform: translateY(-1px); }
    }

    @keyframes staggerItem {
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    
  </style>
</head>
<body>

<div class="container">
    
    <header class="header">
        <div class="logo">
            Bu√¥n M√™<span>ƒê·∫∂C S·∫¢N T√ÇY NGUY√äN</span>
        </div>
    </header>

    <div class="query-box">
        <h3>H·ªèi ThƒÉm **ƒêi·ªÉm √äƒë√™**</h3>
        <div class="input-group">
            <div class="input-wrapper">
                <i class="fas fa-phone"></i>
                <input type="text" id="customerPhoneInput" placeholder="Nh·∫≠p S·ªë ƒëi·ªán tho·∫°i c·ªßa b·∫°n" inputmode="numeric" />
            </div>
            <button class="buonme-button" onclick="getLoyaltyPoints(event)">Tra c·ª©u</button>
        </div>
    </div>

    <div id="loyaltyPointsResult" class="status-card info">
      <i class="fas fa-info-circle"></i> M·ªùi b·∫°n nh·∫≠p S·ªë ƒëi·ªán tho·∫°i r·ªìi nh·∫•n n√∫t "Tra c·ª©u".
    </div>
    
    <section id="historySection" style="display: none;">
        <h3 style="text-align: center; margin-top: 40px; margin-bottom: 20px;">üìú L·ªãch S·ª≠ "C√∫ng Y√†ng"</h3>
        <ul class="history-list" id="historyList">
            </ul>
    </section>

    <section id="exchangeSection">
        <h3 style="text-align: center; margin-top: 40px; margin-bottom: 20px;">üéÅ S·ªï ƒê·ªïi Qu√† Bu√¥n L√†ng</h3>
        <div class="exchange-grid" id="exchangeList">
            </div>
    </section>

    <footer class="footer">
        C·∫£m ∆°n b·∫°n ƒë√£ gh√© **Bu√¥n M√™** ‚Äì Ch√∫c m·ªôt ng√†y ƒë·∫≠m v·ªã T√¢y Nguy√™n!
    </footer>

</div>


<script>
  
  // MOCK DATA: D·ªØ li·ªáu m·∫´u m√¥ ph·ªèng t·ª´ Firebase
  const mockPaymentHistory = [
    { customerPhone: "0901234567", finalTotal: 1250000, date: "2025-11-01", description: "C∆°m Lam v√† G√† N∆∞·ªõng" },
    { customerPhone: "0901234567", finalTotal: 580000, date: "2025-11-15", description: "R∆∞·ª£u C·∫ßn v√† B√≤ M·ªôt N·∫Øng" },
    { customerPhone: "0987654321", finalTotal: 850000, date: "2025-12-01", description: "C√† Ph√™ Bu√¥n M√™" },
    { customerPhone: "0901234567", finalTotal: 2300000, date: "2025-12-10", description: "L·∫©u C√° LƒÉng v√† ƒê·∫∑c S·∫£n" },
    { customerPhone: "0987654321", finalTotal: 1500000, date: "2025-12-12", description: "L·∫©u L√° R·ª´ng v√† Heo R·ª´ng" },
    { customerPhone: "0111222333", finalTotal: 0, date: "2025-10-01", description: "Bill ƒëƒÉng k√Ω th√†nh vi√™n" },
  ];
  
  // MOCK DATA: Danh s√°ch qu√† ƒë·ªïi ƒëi·ªÉm
  const mockExchangeGifts = [
      { id: 1, name: "C√† Ph√™ Nguy√™n Ch·∫•t 200g", points: 300, icon: "fa-seedling", description: "H∆∞∆°ng v·ªã Bu√¥n Ma Thu·ªôt ƒë√≠ch th·ª±c." },
      { id: 2, name: "Ch√© R∆∞·ª£u C·∫ßn Nh·ªè", points: 500, icon: "fa-mug-hot", description: "Giao l∆∞u vƒÉn ho√° c√πng b·∫°n b√®." },
      { id: 3, name: "Voucher 100K (Gi·∫£m gi√°)", points: 100, icon: "fa-tag", description: "S·ª≠ d·ª•ng cho h√≥a ƒë∆°n ti·∫øp theo." },
      { id: 4, name: "Mi·ªÖn Ph√≠ M√≥n G√† N∆∞·ªõng", points: 800, icon: "fa-drumstick-bite", description: "M√≥n t·ªß c·ªßa Gi√† L√†ng." },
  ];


  // Quy t·∫Øc t√≠nh ƒëi·ªÉm: 1,000,000 VNƒê = 100 ƒëi·ªÉm √äƒë√™.
  const POINTS_PER_MILLION = 100;
  
  // H√†m l·∫•y c·∫•p th√†nh vi√™n
  function getMemberLevel(points) {
    if (points >= 500) return { name: "Gi√† L√†ng VIP", icon: "fa-crown", color: "#daa520" };
    if (points >= 300) return { name: "Th√†nh vi√™n M∆∞·ªùng", icon: "fa-drum", color: "#8a3f2d" };
    if (points >= 100) return { name: "Th√†nh vi√™n Nh√† D√†i", icon: "fa-home", color: "#7a4f32" };
    if (points > 0) return { name: "Th√†nh vi√™n Bu√¥n", icon: "fa-users", color: "#4a2e1f" };
    return { name: "Th√†nh vi√™n Bu√¥n m·ªõi", icon: "fa-users", color: "#4a2e1f" };
  }

  // H√†m t·∫°o hi·ªáu ·ª©ng Ripple cho button
  function createRipple(event) {
    const button = event.currentTarget;
    const circle = document.createElement("span");
    const diameter = Math.max(button.clientWidth, button.clientHeight);
    const radius = diameter / 2;

    circle.style.width = circle.style.height = `${diameter}px`;
    circle.style.left = `${event.clientX - (button.offsetLeft + radius)}px`;
    circle.style.top = `${event.clientY - (button.offsetTop + radius)}px`;
    circle.classList.add("ripple");

    const ripple = button.getElementsByClassName("ripple")[0];
    if (ripple) {
      ripple.remove();
    }
    button.appendChild(circle);
  }
  
  // H√†m hi·ªÉn th·ªã danh s√°ch ƒë·ªïi ƒëi·ªÉm
  function renderExchangeGifts(currentPoints) {
    const exchangeList = document.getElementById("exchangeList");
    exchangeList.innerHTML = '';
    
    mockExchangeGifts.forEach((gift, index) => {
        const isAffordable = currentPoints >= gift.points;
        const cardElement = document.createElement('div');
        cardElement.className = 'exchange-card';
        cardElement.style.animation = `scaleIn 0.5s forwards ${1.2 + (index * 0.1)}s`;
        
        const buttonText = isAffordable ? 'ƒê·ªîI NGAY!' : 'Thi·∫øu ƒêi·ªÉm';
        const buttonDisabled = !isAffordable;
        const buttonClass = isAffordable ? '' : 'disabled';
        
        cardElement.innerHTML = `
            <div class="exchange-card-icon"><i class="fas ${gift.icon}"></i></div>
            <h4>${gift.name}</h4>
            <p>${gift.description}</p>
            <div class="points-required">
                <i class="fas fa-hand-holding-usd"></i> ${gift.points.toLocaleString()} ƒêi·ªÉm
            </div>
            <button 
                class="exchange-button ${buttonClass}" 
                ${buttonDisabled ? 'disabled' : ''}
                onclick="alert('Ch·ª©c nƒÉng ƒë·ªïi ƒëi·ªÉm cho ${gift.name} s·∫Ω ƒë∆∞·ª£c k√≠ch ho·∫°t t·∫°i qu·∫ßy!')"
            >
                ${buttonText}
            </button>
        `;
        exchangeList.appendChild(cardElement);
    });
    
    // Hi·ªÉn th·ªã v√† animation section
    const exchangeSection = document.getElementById("exchangeSection");
    exchangeSection.style.display = 'block';
    exchangeSection.style.animation = 'slideUp 0.8s forwards 0.8s';
  }

  // --- H√ÄM T√çNH ƒêI·ªÇM T√çCH L≈®Y CH√çNH ---
  async function getLoyaltyPoints(event) {
    // 1. Trigger Ripple Animation
    createRipple(event);

    const phoneInput = document.getElementById("customerPhoneInput");
    const phone = phoneInput.value.trim();
    const resultDiv = document.getElementById("loyaltyPointsResult");
    const historySection = document.getElementById("historySection");
    const historyList = document.getElementById("historyList");
    const exchangeSection = document.getElementById("exchangeSection");
    
    // ·∫®n c√°c ph·∫ßn ph·ª• khi b·∫Øt ƒë·∫ßu tra c·ª©u m·ªõi
    historySection.style.display = 'none';
    historyList.innerHTML = '';
    
    // T·∫°m th·ªùi ·∫©n c√°c th·∫ª qu√†
    document.getElementById("exchangeList").innerHTML = '';
    exchangeSection.style.opacity = 0; 

    // Clear previous animation/visibility
    resultDiv.style.opacity = 0; 
    resultDiv.style.transform = 'translateY(20px)';

    // Ki·ªÉm tra ƒë·∫ßu v√†o
    if (!phone) {
      resultDiv.innerHTML = `<i class="fas fa-info-circle"></i> √ä-xem! Vui l√≤ng nh·∫≠p **S·ªë ƒëi·ªán tho·∫°i** c·ªßa b·∫°n.`;
      resultDiv.className = "status-card info";
      animateResultCard(resultDiv, 0.1);
      return;
    }

    resultDiv.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Bu√¥n L√†ng ƒëang tra c·ª©u th√¥ng tin cho SƒêT: **${phone}**...`;
    resultDiv.className = "status-card info";
    animateResultCard(resultDiv, 0.1);

    // M√î PH·ªéNG TH·ªúI GIAN TRA C·ª®U
    await new Promise(resolve => setTimeout(resolve, 800));

    // L·ªçc d·ªØ li·ªáu t·ª´ Mock-up
    const customerHistory = mockPaymentHistory.filter(data => data.customerPhone && data.customerPhone.trim() === phone);
    
    let totalAmount = 0;
    let billFound = customerHistory.length > 0;
    const historyItems = [];
    let loyaltyPoints = 0;
    
    // T√≠nh t·ªïng v√† thu th·∫≠p l·ªãch s·ª≠
    customerHistory.forEach(data => {
        const finalTotal = parseFloat(data.finalTotal);
        if (!isNaN(finalTotal) && finalTotal > 0) {
            totalAmount += finalTotal;
            // T√≠nh ƒëi·ªÉm t√≠ch l≈©y cho bill ƒë√≥ (ƒë·ªÉ hi·ªÉn th·ªã)
            const pointsGained = Math.floor(finalTotal / 1000000) * POINTS_PER_MILLION;
            historyItems.push({
                date: data.date,
                description: data.description,
                amount: finalTotal,
                points: pointsGained
            });
        }
    });

    // S·∫Øp x·∫øp l·ªãch s·ª≠ theo ng√†y m·ªõi nh·∫•t l√™n tr∆∞·ªõc
    historyItems.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    if (totalAmount > 0) {
        loyaltyPoints = Math.floor(totalAmount / 1000000) * POINTS_PER_MILLION;
    }


    // LOGIC X·ª¨ L√ù K·∫æT QU·∫¢
    if (!billFound) {
        // Tr∆∞·ªùng h·ª£p 1: Kh√¥ng t√¨m th·∫•y SƒêT n√†o kh·ªõp
        resultDiv.innerHTML = `
            <i class="fas fa-exclamation-circle"></i>
            A-chi! R·∫•t ti·∫øc, S·ªë ƒëi·ªán tho·∫°i **${phone}** ch∆∞a c√≥ trong danh s√°ch kh√°ch qu√Ω c·ªßa Bu√¥n L√†ng.
            <br>
            **B·∫°n ch∆∞a ƒëƒÉng k√Ω th√†nh vi√™n.** M·ªùi b·∫°n gh√© qu·∫ßy g·∫∑p **P√¥** (nh√¢n vi√™n) ƒë·ªÉ ƒëƒÉng k√Ω ngay v√† nh·∫≠n qu√† nha!
        `;
        resultDiv.className = "status-card error";
        
    } else if (totalAmount > 0) {
        // Tr∆∞·ªùng h·ª£p 2: C√≥ h√≥a ƒë∆°n v√† t·ªïng ti·ªÅn > 0
        const formattedPoints = loyaltyPoints.toLocaleString('vi-VN');
        const formattedTotal = totalAmount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
        const memberLevel = getMemberLevel(loyaltyPoints);
        
        resultDiv.innerHTML = `
            <div class="result-card-inner">
                <div class="result-icon" style="background-color: ${memberLevel.color};">
                    <i class="fas ${memberLevel.icon}"></i>
                </div>
                <div class="result-details">
                    <p>Ch√†o m·ª´ng **A-mi** (ng∆∞·ªùi th√¢n)! B·∫°n l√†:</p>
                    <div class="member-level">${memberLevel.name}</div>
                    <p style="margin-top: 15px;">ƒêi·ªÉm √äƒë√™ ƒë√£ t√≠ch l≈©y:</p>
                    <div class="loyalty-points-display">${formattedPoints}</div>
                    <p>T·ªïng chi ti√™u (Ti·ªÅn c√∫ng Y√†ng): **${formattedTotal}**</p>
                    <p style="margin-top: 10px; font-size: 0.9em; font-style: italic; color: var(--wood-medium);">
                        H√£y d√πng ƒêi·ªÉm √äƒë√™ n√†y ƒë·ªÉ ƒë·ªïi l·∫•y ƒë·∫∑c s·∫£n Bu√¥n L√†ng nh√©!
                    </p>
                </div>
            </div>
        `;
        resultDiv.className = "status-card success";
        
        // Hi·ªÉn th·ªã L·ªãch s·ª≠
        if (historyItems.length > 0) {
            historySection.style.display = 'block';
            historySection.style.animation = 'slideUp 0.8s forwards 0.8s';
            
            historyItems.forEach((item, index) => {
                const itemElement = document.createElement('li');
                itemElement.className = 'history-item';
                
                const pointsText = item.points > 0 ? `+${item.points.toLocaleString()} ƒêi·ªÉm` : '0 ƒêi·ªÉm';
                const pointsClass = item.points > 0 ? 'plus' : '';
                
                itemElement.innerHTML = `
                    <div class="history-icon"><i class="fas fa-coffee"></i></div>
                    <div class="history-details">
                        <p><strong>${item.description}</strong></p>
                        <p class="date">${new Date(item.date).toLocaleDateString('vi-VN')} | ${item.amount.toLocaleString('vi-VN')} VNƒê</p>
                    </div>
                    <div class="history-points ${pointsClass}">${pointsText}</div>
                `;
                historyList.appendChild(itemElement);
                
                // Stagger List Animation
                itemElement.style.animation = `staggerItem 0.5s forwards ${1.0 + (index * 0.08)}s`;
                itemElement.style.transform = 'translateY(10px)';
            });
        }
        
        // Render Danh s√°ch ƒë·ªïi ƒëi·ªÉm sau khi c√≥ ƒëi·ªÉm t√≠ch l≈©y
        renderExchangeGifts(loyaltyPoints);
        
    } else {
        // Tr∆∞·ªùng h·ª£p 3: T√¨m th·∫•y SƒêT nh∆∞ng ch∆∞a c√≥ bill n√†o c√≥ totalAmount > 0
        resultDiv.innerHTML = `
            <i class="fas fa-handshake"></i>
            **H∆°-nhƒ©!** S·ªë ƒëi·ªán tho·∫°i **${phone}** ƒë√£ l√† ng∆∞·ªùi th√¢n c·ªßa Bu√¥n L√†ng r·ªìi!
            <br>
            Hi·ªán t·∫°i, b·∫°n **ch∆∞a c√≥ ƒêi·ªÉm √äƒë√™** n√†o. L·∫ßn t·ªõi gh√© Bu√¥n L√†ng, nh·ªõ g·ªçi th√™m m√≥n ƒë·ªÉ t√≠ch ƒëi·ªÉm nh√©!
        `;
        resultDiv.className = "status-card info";
        
        // V·∫´n render danh s√°ch ƒë·ªïi ƒëi·ªÉm ƒë·ªÉ khuy·∫øn kh√≠ch
        renderExchangeGifts(0);
    }
    
    // Th·∫ª K·∫øt Qu·∫£ Animation: slide‚Äìup + fade + nh·∫π bounce
    animateResultCard(resultDiv, 0.5); 
  }
  
  // H√†m x·ª≠ l√Ω animation cho th·∫ª k·∫øt qu·∫£
  function animateResultCard(element, delay) {
      setTimeout(() => {
          element.style.opacity = 1;
          element.style.transform = 'translateY(0)';
          element.style.animation = 'bounce 0.8s ease-out';
          setTimeout(() => element.style.animation = 'none', 800);
      }, delay * 1000);
  }
  
  // Expose the function globally
  window.getLoyaltyPoints = getLoyaltyPoints;
  
  // Hi·ªÉn th·ªã ph·∫ßn qu√† ƒë·ªïi ƒëi·ªÉm ngay c·∫£ khi ch∆∞a tra c·ª©u (v·ªõi 0 ƒëi·ªÉm)
  document.addEventListener('DOMContentLoaded', () => {
    renderExchangeGifts(0);
  });

</script>

</body>
</html>
