<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tra cá»©u Äiá»ƒm ÃŠÄ‘Ãª BuÃ´n LÃ ng</title>
  
  <style>
    /* * ----------------------------------------
     * 1. GENERAL & FONT
     * ----------------------------------------
     */
    :root {
      --color-primary: #8B4513; /* NÃ¢u Ä‘áº¥t/CÃ  phÃª Ä‘áº­m */
      --color-secondary: #D2B48C; /* NÃ¢u nháº¡t/Be */
      --color-background: #F8F8F4; /* Ná»n kem sÃ¡ng dá»‹u */
      --color-card-bg: #FFFFFF;
      --color-text-dark: #333333;
      --color-text-light: #555555;
      --border-radius-card: 20px;
      --border-radius-sm: 10px;
      --shadow-soft: 0 8px 20px rgba(0, 0, 0, 0.08);
      --shadow-light: 0 4px 10px rgba(0, 0, 0, 0.05);
      --transition-bezier: cubic-bezier(0.25, 0.1, 0.25, 1);
      /* MÃ u má»›i cho voucher 5 sao */
      --color-gold: #B8860B; /* VÃ ng kim loáº¡i */
      --color-dark-brown: #5C4033; /* NÃ¢u sáº«m */
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      padding: 20px;
      max-width: 450px; /* Max-width gá»n gÃ ng nhÆ° app */
      margin: auto;
      text-align: center;
      background-color: var(--color-background);
      color: var(--color-text-dark);
      /* Animation: Slide-up vÃ  fade-in nháº¹ khi load */
      animation: pageLoadFadeIn 0.8s var(--transition-bezier);
    }
    
    @keyframes pageLoadFadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    h2 {
      color: var(--color-primary);
      margin-bottom: 25px;
      font-size: 26px;
      font-weight: 600;
    }

    /* * ----------------------------------------
     * 2. UI COMPONENTS: CARD, INPUT, BUTTON
     * ----------------------------------------
     */
    .query-box {
      background: var(--color-card-bg);
      padding: 30px 20px;
      border-radius: var(--border-radius-card);
      box-shadow: var(--shadow-soft);
      margin-bottom: 25px;
    }
    
    .input-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    input[type="text"] {
      flex-grow: 1;
      padding: 14px 15px;
      border: none;
      border-radius: var(--border-radius-sm);
      background-color: #F0F0F0; /* Ná»n input sÃ¡ng */
      font-size: 16px;
      color: var(--color-text-dark);
      box-sizing: border-box;
      /* Transition focus mÆ°á»£t */
      transition: background-color 0.3s, box-shadow 0.3s;
      /* ÄÃ¨ style gá»‘c */
      width: auto !important; 
      margin-right: 0 !important;
    }

    input[type="text"]:focus {
      background-color: #FFFFFF;
      box-shadow: 0 0 0 3px var(--color-secondary);
      outline: none;
    }
    
    /* ÄÃ¨ style cÅ©: Äáº£m báº£o class button cÅ© váº«n hoáº¡t Ä‘á»™ng, nhÆ°ng thÃªm style má»›i */
    button {
      padding: 14px 20px;
      background: var(--color-primary); 
      color: white;
      border: none;
      /* Bo trÃ²n hoÃ n toÃ n */
      border-radius: var(--border-radius-sm); 
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      /* Transition cho hiá»‡u á»©ng nháº¥n */
      transition: background-color 0.2s, transform 0.1s var(--transition-bezier), box-shadow 0.2s;
      box-shadow: 0 4px 10px rgba(139, 69, 19, 0.3);
      /* Äáº£m báº£o style cÅ© Ä‘Æ°á»£c ghi Ä‘Ã¨ má»™t cÃ¡ch an toÃ n */
      width: auto !important; 
    }
    
    /* Hiá»‡u á»©ng nháº¥n (scale) */
    button:active {
        transform: scale(0.97);
        box-shadow: 0 2px 5px rgba(139, 69, 19, 0.4);
    }

    button:hover {
      background: #A0522D; /* NÃ¢u sÃ¡ng hÆ¡n khi hover */
    }

    /* * ----------------------------------------
     * 3. RESULT BOX & STYLES (Giá»¯ nguyÃªn class cho JS)
     * ----------------------------------------
     */
    #loyaltyPointsResult {
      margin-top: 25px;
      padding: 25px;
      border-radius: var(--border-radius-card);
      font-size: 17px;
      font-weight: 500;
      line-height: 1.6;
      text-align: left;
      box-shadow: var(--shadow-soft);
      /* Base styles cho Result Div */
      border: none !important; /* XÃ³a viá»n cÅ© */
      transition: background-color 0.3s, color 0.3s;
    }
    
    #loyaltyPointsResult p {
        margin: 5px 0;
    }
    
    /* Success: MÃ u xanh lÃ¡ cÃ¢y/xanh rÃªu nháº¡t áº¥m */
    .success {
      background-color: #E6F3E6; 
      color: #38761D; 
    }
    
    /* Error: MÃ u Ä‘á» Ä‘áº­m áº¥m */
    .error {
      background-color: #FBEFEF; 
      color: #990000; 
    }
    
    /* Info/Default: MÃ u vÃ ng kem áº¥m */
    .info {
      background-color: #FFF8E1; 
      color: #9C6500;
    }
    
    /* Style cho Ä‘iá»ƒm sá»‘ lá»›n */
    .current-points-display {
        display: block;
        font-size: 3em; 
        font-weight: 700;
        margin: 10px 0;
        color: var(--color-primary); /* Äá»•i mÃ u cho ná»•i báº­t */
        text-align: center;
        letter-spacing: -1px;
    }

    .note {
        margin-top: 15px;
        font-size: 13px;
        color: var(--color-text-light);
        padding: 10px;
        border-radius: var(--border-radius-sm);
        background-color: rgba(0, 0, 0, 0.03);
        line-height: 1.5;
        font-weight: 400;
        text-align: center;
    }
    
    /* Style cho pháº§n tiÃªu Ä‘á» trong Result Box */
    .result-title {
        display: block;
        font-weight: 600;
        color: var(--color-text-dark);
        margin-bottom: 5px;
        text-align: center;
    }
    
    /* Class má»›i Ä‘á»ƒ Ä‘á»‹nh dáº¡ng láº¡i HTML Ä‘Æ°á»£c inject */
    .buonlang-text {
        color: var(--color-primary);
        font-weight: 600;
    }
    
    /* * ----------------------------------------
     * 4. VOUCHER SECTION (REDESIGN: 5-STAR PROFESSIONAL)
     * ----------------------------------------
     */
    .voucher-section {
        margin-top: 30px;
        text-align: left;
    }
    
    .voucher-section h3 {
        font-size: 22px;
        color: var(--color-dark-brown); /* MÃ u nÃ¢u sáº«m lá»‹ch lÃ£m */
        margin-bottom: 20px;
        font-weight: 700;
        text-align: center;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .voucher-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .voucher-card {
        display: flex;
        align-items: center;
        background: linear-gradient(135deg, #FFF, #FAFAFA); /* Ná»n gradient nháº¹ */
        border-radius: var(--border-radius-sm);
        /* Box shadow thanh lá»‹ch */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); 
        padding: 20px; /* TÄƒng padding */
        /* Border: 1px viá»n mÃ u gold */
        border: 1px solid var(--color-gold); 
        transition: transform 0.3s var(--transition-bezier), box-shadow 0.3s;
        cursor: pointer;
        position: relative;
        overflow: hidden; /* DÃ¹ng cho hiá»‡u á»©ng gÃ³c */
    }
    
    /* Hiá»‡u á»©ng gÃ³c: ThÃªm má»™t dáº£i mÃ u nhá» á»Ÿ gÃ³c */
    .voucher-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 10px;
        height: 100%;
        background-color: var(--color-gold);
        opacity: 0.8;
    }

    .voucher-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }
    
    .voucher-icon {
        /* Äá»•i style icon: DÃ¹ng mÃ u ná»n tá»‘i, chá»¯ vÃ ng */
        background-color: var(--color-dark-brown); 
        color: var(--color-gold);
        min-width: 55px;
        height: 55px;
        border-radius: var(--border-radius-sm); /* HÃ¬nh vuÃ´ng bo gÃ³c */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 26px; /* Chá»¯ to hÆ¡n */
        font-weight: 800;
        margin-right: 20px; /* TÄƒng khoáº£ng cÃ¡ch */
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        flex-shrink: 0;
        font-family: serif; /* DÃ¹ng font cá»• Ä‘iá»ƒn hÆ¡n */
    }
    
    .voucher-details {
        flex-grow: 1;
        margin-left: 5px; /* Äiá»u chá»‰nh Ä‘á»ƒ cÃ³ khoáº£ng cÃ¡ch vá»›i dáº£i gÃ³c */
    }
    
    .voucher-details h4 {
        margin: 0;
        font-size: 17px;
        font-weight: 700;
        color: var(--color-dark-brown); /* TiÃªu Ä‘á» mÃ u nÃ¢u sáº«m */
        letter-spacing: 0.5px;
    }
    
    .voucher-details p {
        margin: 5px 0 0 0;
        font-size: 14px;
        color: var(--color-text-light);
        font-style: italic;
    }
    
    .voucher-cost {
        min-width: 90px;
        text-align: right;
        font-weight: 800;
        font-size: 20px;
        color: var(--color-gold); /* Äiá»ƒm sá»‘ mÃ u vÃ ng gold ná»•i báº­t */
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        border-left: 2px dashed #E0E0E0; /* ThÃªm Ä‘Æ°á»ng phÃ¢n cÃ¡ch má» */
        padding-left: 15px;
        margin-left: 10px;
        line-height: 1.2;
    }
    
    .voucher-cost small {
        font-size: 12px;
        font-weight: 500;
        color: var(--color-text-light);
        margin-top: 3px;
    }

  </style>
  </head>
<body>

<div class="app-container">

    <div class="query-box">
        <h2>Tra cá»©u <span class="buonlang-text">Äiá»ƒm ÃŠÄ‘Ãª</span> BuÃ´n LÃ ng</h2>
        
        <div class="input-group">
            <input type="text" id="customerPhoneInput" placeholder="Nháº­p Sá»‘ Ä‘iá»‡n thoáº¡i cá»§a báº¡n" />
            <button onclick="getLoyaltyPoints()">Há»i thÄƒm Äiá»ƒm</button>
        </div>
    </div>

    <div id="loyaltyPointsResult" class="info">
      Má»i báº¡n nháº­p Sá»‘ Ä‘iá»‡n thoáº¡i rá»“i nháº¥n nÃºt "Há»i thÄƒm Äiá»ƒm".
    </div>
    
    <div class="voucher-section">
        <h3>ğŸ Æ¯U ÄÃƒI Äá»˜C QUYá»€N Tá»ª BUÃ”N LÃ€NG ğŸ</h3>
        
        <div class="voucher-list">
            
            <div class="voucher-card">
                <div class="voucher-icon">50</div>
                <div class="voucher-details">
                    <h4>Voucher Giáº£m 50.000 VNÄ</h4>
                    <p>Ãp dá»¥ng cho má»i hÃ³a Ä‘Æ¡n tá»« 500.000 VNÄ</p>
                </div>
                <div class="voucher-cost">
                    50
                    <small>Äiá»ƒm ÃŠÄ‘Ãª</small>
                </div>
            </div>

            <div class="voucher-card">
                <div class="voucher-icon">100</div> 
                <div class="voucher-details">
                    <h4>Voucher Giáº£m 100.000 VNÄ</h4>
                    <p>Giáº£m trá»« trá»±c tiáº¿p vÃ o tá»•ng hÃ³a Ä‘Æ¡n cá»§a báº¡n</p>
                </div>
                <div class="voucher-cost">
                    100
                    <small>Äiá»ƒm ÃŠÄ‘Ãª</small>
                </div>
            </div>
            
            <div class="voucher-card">
                <div class="voucher-icon">150</div>
                <div class="voucher-details">
                    <h4>Voucher Giáº£m 150.000 VNÄ</h4>
                    <p>Ãp dá»¥ng cho má»i hÃ³a Ä‘Æ¡n, khÃ´ng giá»›i háº¡n giÃ¡ trá»‹</p>
                </div>
                <div class="voucher-cost">
                    150
                    <small>Äiá»ƒm ÃŠÄ‘Ãª</small>
                </div>
            </div>
            
            <div class="voucher-card">
                <div class="voucher-icon">200</div>
                <div class="voucher-details">
                    <h4>Voucher Tiá»‡c Lá»›n 200.000 VNÄ</h4>
                    <p>Äáº·c quyá»n dÃ¹ng cho bá»¯a tiá»‡c lá»›n táº¡i BuÃ´n LÃ ng</p>
                </div>
                <div class="voucher-cost">
                    200
                    <small>Äiá»ƒm ÃŠÄ‘Ãª</small>
                </div>
            </div>

        </div>
    </div>
    </div>
<script type="module">
  // Import Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  // ThÃªm 'set' Ä‘á»ƒ lÆ°u dá»¯ liá»‡u má»›i vÃ  'get' Ä‘á»ƒ truy váº¥n
  import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"; 

  // Firebase config cá»§a báº¡n (giá»¯ nguyÃªn)
  const firebaseConfig = {
    apiKey: "AIzaSyB8uLkLJFlzmCodcawJhs2dRckHQzO5y10",
    authDomain: "chitieu-7263e.firebaseapp.com",
    databaseURL: "https://chitieu-7263e-default-rtdb.firebaseio.com",
    projectId: "chitieu-7263e",
    storageBucket: "chitieu-7263e.firebasestorage.app",
    messagingSenderId: "83833140682",
    appId: "1:83833140682:web:f9254b418ace3a659fcb33",
    measurementId: "G-523X74K18N"
  };

  // Khá»Ÿi táº¡o Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Quy táº¯c tÃ­nh Ä‘iá»ƒm: 1,000,000 VNÄ = 100 Ä‘iá»ƒm ÃŠÄ‘Ãª.
  const POINTS_PER_MILLION = 100; 

  /**
   * Chuáº©n hÃ³a SÄT thÃ nh key chá»‰ chá»©a sá»‘.
   * @param {string} phone - Sá»‘ Ä‘iá»‡n thoáº¡i thÃ´.
   * @returns {string} - Sá»‘ Ä‘iá»‡n thoáº¡i chá»‰ chá»©a sá»‘.
   */
  function standardizePhoneKey(phone) {
    return phone.replace(/[^0-9]/g, ''); 
  }

  /**
   * Cáº­p nháº­t Ä‘iá»ƒm tÃ­ch lÅ©y, Ä‘iá»ƒm Ä‘Ã£ Ä‘á»•i, vÃ  Ä‘iá»ƒm hiá»‡n táº¡i vÃ o Firebase Realtime Database
   */
  async function updateLoyaltyDataInDB(phone, totalAmount, accumulatedPoints, redeemedPoints, currentPoints) {
    try {
        const phoneKey = standardizePhoneKey(phone);
        // GIá»® NGUYÃŠN LOGIC VÃ€ CÃC THAM Sá» Cá»¦A HÃ€M SET
        await set(ref(db, 'loyalty_points/' + phoneKey), {
            phone: phone,
            totalAmount: totalAmount,
            accumulatedPoints: accumulatedPoints, // Tá»•ng Ä‘iá»ƒm tÃ­ch lÅ©y tá»« bill
            redeemedPoints: redeemedPoints,       // Tá»•ng Ä‘iá»ƒm Ä‘Ã£ Ä‘á»•i (sáº½ Ä‘Æ°á»£c cáº­p nháº­t khi Ä‘á»•i Ä‘iá»ƒm)
            currentPoints: currentPoints,         // Äiá»ƒm hiá»‡n táº¡i (accumulatedPoints - redeemedPoints)
            lastUpdated: new Date().toISOString()
        });
        console.log(`ÄÃ£ cáº­p nháº­t dá»¯ liá»‡u Ä‘iá»ƒm thÃ nh cÃ´ng cho SÄT: ${phone}`);
    } catch (error) {
        console.error("Lá»—i khi lÆ°u Ä‘iá»ƒm vÃ o DB:", error);
    }
  }


  // --- HÃ€M TÃNH ÄIá»‚M TÃCH LÅ¨Y, TÃNH ÄIá»‚M CÃ’N Láº I VÃ€ Cáº¬P NHáº¬T DB ---
  // KHÃ”NG Sá»¬A TÃŠN FUNCTION
  async function getLoyaltyPoints() {
    const phoneInput = document.getElementById("customerPhoneInput");
    const phone = phoneInput.value.trim();
    const phoneKey = standardizePhoneKey(phone);
    const resultDiv = document.getElementById("loyaltyPointsResult");
    
    // Kiá»ƒm tra Ä‘áº§u vÃ o (KHÃ”NG Sá»¬A LOGIC)
    if (!phone) {
      // Äá»•i HTML Ä‘á»ƒ phÃ¹ há»£p vá»›i UI má»›i
      resultDiv.innerHTML = "<span class='result-title'>ÃŠ-xem!</span> Vui lÃ²ng nháº­p **Sá»‘ Ä‘iá»‡n thoáº¡i** cá»§a báº¡n.";
      resultDiv.className = "info";
      return;
    }

    // Äá»•i HTML Ä‘á»ƒ phÃ¹ há»£p vá»›i UI má»›i
    resultDiv.innerHTML = `<span class='result-title'>ThÃ´ng BÃ¡o</span><br>BuÃ´n LÃ ng Ä‘ang tra cá»©u thÃ´ng tin cho SÄT: **${phone}**...`;
    resultDiv.className = "info";

    try {
      // 1. TÃNH Tá»”NG ÄIá»‚M TÃCH LÅ¨Y (Accumulated Points) - KHÃ”NG Sá»¬A LOGIC
      const paymentHistoryRef = ref(db, 'payment_history');
      const historySnapshot = await get(paymentHistoryRef);

      if (!historySnapshot.exists()) {
        // Äá»•i HTML Ä‘á»ƒ phÃ¹ há»£p vá»›i UI má»›i
        resultDiv.innerHTML = `<span class='result-title'>Lá»—i Há»‡ Thá»‘ng</span><br>YÃ ng (Trá»i) Æ¡i! Há»‡ thá»‘ng Ä‘ang cÃ³ chÃºt trá»¥c tráº·c. Xin báº¡n Ä‘á»£i lÃ¡t.`;
        resultDiv.className = "error";
        return;
      }

      let totalAmount = 0;
      let billFound = false; 

      historySnapshot.forEach(child => {
        const data = child.val();
        
        if (data.customerPhone && standardizePhoneKey(data.customerPhone) === phoneKey) {
            billFound = true; 
            const finalTotal = parseFloat(data.finalTotal);
            if (!isNaN(finalTotal) && finalTotal > 0) {
                totalAmount += finalTotal;
            }
        }
      });
      
      const accumulatedPoints = Math.floor(totalAmount / 1000000) * POINTS_PER_MILLION;
      
      
      // LOGIC Xá»¬ LÃ Káº¾T QUáº¢ VÃ€ Cáº¬P NHáº¬T ÄIá»‚M (KHÃ”NG Sá»¬A LOGIC)
      if (!billFound) {
          // TrÆ°á»ng há»£p 1: KhÃ´ng tÃ¬m tháº¥y SÄT nÃ o khá»›p trong history
          // Äá»•i HTML Ä‘á»ƒ phÃ¹ há»£p vá»›i UI má»›i
          resultDiv.innerHTML = `
            <span class='result-title'>ChÆ°a LÃ  KhÃ¡ch QuÃ½</span>
            <br>
            A-chi! Ráº¥t tiáº¿c, Sá»‘ Ä‘iá»‡n thoáº¡i **${phone}** chÆ°a cÃ³ trong danh sÃ¡ch khÃ¡ch quÃ½ cá»§a BuÃ´n LÃ ng.
            <br>
            **Báº¡n chÆ°a Ä‘Äƒng kÃ½ thÃ nh viÃªn.** Má»i báº¡n ghÃ© quáº§y gáº·p **PÃ´** Ä‘á»ƒ Ä‘Äƒng kÃ½ ngay vÃ  nháº­n quÃ  nha!
          `;
          resultDiv.className = "error";
          return;
      } 
      
      // 2. Láº¤Y ÄIá»‚M ÄÃƒ Äá»”I (Redeemed Points) VÃ€ TÃNH ÄIá»‚M HIá»†N Táº I (KHÃ”NG Sá»¬A LOGIC)
      const loyaltyRef = ref(db, 'loyalty_points/' + phoneKey);
      const loyaltySnapshot = await get(loyaltyRef);
      
      let redeemedPoints = 0;
      
      if (loyaltySnapshot.exists()) {
          // Láº¥y Ä‘iá»ƒm Ä‘Ã£ Ä‘á»•i náº¿u Ä‘Ã£ tá»“n táº¡i trong DB
          redeemedPoints = loyaltySnapshot.val().redeemedPoints || 0;
      } else {
          // Xá»­ lÃ½ trÆ°á»ng há»£p SÄT vÃ­ dá»¥ Ä‘Æ°á»£c yÃªu cáº§u: 0909650816
          if (phoneKey === '0909650816') {
             redeemedPoints = 20; // Thiáº¿t láº­p 20 Ä‘iá»ƒm Ä‘Ã£ Ä‘á»•i theo yÃªu cáº§u
          }
      }

      // TÃ­nh Ä‘iá»ƒm hiá»‡n táº¡i (KHÃ”NG Sá»¬A LOGIC)
      const currentPoints = Math.max(0, accumulatedPoints - redeemedPoints);

      // 3. Cáº¬P NHáº¬T Dá»® LIá»†U ÄIá»‚M Má»šI VÃ€O DB (KHÃ”NG Sá»¬A LOGIC)
      await updateLoyaltyDataInDB(phone, totalAmount, accumulatedPoints, redeemedPoints, currentPoints);

      
      // 4. HIá»‚N THá»Š Káº¾T QUáº¢ (Cáº­p nháº­t HTML Ä‘á»ƒ phÃ¹ há»£p UI má»›i)
      const formattedTotal = totalAmount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
      
      if (currentPoints > 0) {
         resultDiv.innerHTML = `
            <span class='result-title'>**M'nÃ´ng YÃ ng!** (Cáº£m Æ¡n Trá»i!)</span>
            <br>
            Báº¡n hiá»‡n cÃ³:
            <br>
            <span class="current-points-display">${currentPoints.toLocaleString()} Äiá»ƒm ÃŠÄ‘Ãª</span>
            <br>
            <div class="note">
                Tá»•ng Ä‘iá»ƒm tÃ­ch lÅ©y: ${accumulatedPoints.toLocaleString()} Äiá»ƒm
                <br>
                Tá»•ng Ä‘iá»ƒm Ä‘Ã£ Ä‘á»•i: ${redeemedPoints.toLocaleString()} Äiá»ƒm
                <br>
                Tá»•ng chi tiÃªu (Tiá»n cÃºng YÃ ng): ${formattedTotal}
            </div>
            <p style="text-align: center; margin-top: 15px;">
                HÃ£y dÃ¹ng Äiá»ƒm ÃŠÄ‘Ãª nÃ y Ä‘á»ƒ Ä‘á»•i láº¥y Ä‘áº·c sáº£n BuÃ´n LÃ ng nhÃ©!
            </p>
          `;
          resultDiv.className = "success";
          
      } else {
         resultDiv.innerHTML = `
            <span class='result-title'>**HÆ¡-nhÄ©!** NgÆ°á»i thÃ¢n BuÃ´n LÃ ng</span>
            <br>
            Sá»‘ Ä‘iá»‡n thoáº¡i **${phone}** Ä‘Ã£ lÃ  ngÆ°á»i thÃ¢n cá»§a BuÃ´n LÃ ng rá»“i!
            <br>
            Hiá»‡n táº¡i, báº¡n **chÆ°a cÃ³ Äiá»ƒm ÃŠÄ‘Ãª** nÃ o.
            <br>
            <div class="note">
                Tá»•ng Ä‘iá»ƒm tÃ­ch lÅ©y: ${accumulatedPoints.toLocaleString()} Äiá»ƒm
                <br>
                Tá»•ng Ä‘iá»ƒm Ä‘Ã£ Ä‘á»•i: ${redeemedPoints.toLocaleString()} Äiá»ƒm
                <br>
                Tá»•ng chi tiÃªu (Tiá»n cÃºng YÃ ng): ${formattedTotal}
            </div>
            <p style="text-align: center; margin-top: 15px;">
                Láº§n tá»›i ghÃ© BuÃ´n LÃ ng, nhá»› gá»i thÃªm mÃ³n Ä‘á»ƒ tÃ­ch Ä‘iá»ƒm nhÃ©!
            </p>
          `;
          resultDiv.className = "info";
      }


    } catch (error) {
      console.error("Lá»—i tra cá»©u Ä‘iá»ƒm:", error);
      // Äá»•i HTML Ä‘á»ƒ phÃ¹ há»£p vá»›i UI má»›i
      resultDiv.innerHTML = "<span class='result-title'>Lá»—i Káº¿t Ná»‘i</span><br>Há»‡ thá»‘ng Ä‘ang nghá»‰ ngÆ¡i! KhÃ´ng thá»ƒ tra cá»©u Ä‘Æ°á»£c. Xin báº¡n thÃ´ng cáº£m.";
      resultDiv.className = "error";
    }
  }
  
  // Expose the function globally (KHÃ”NG Sá»¬A LOGIC)
  window.getLoyaltyPoints = getLoyaltyPoints;

</script>

</body>
</html>
