<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ƒê√°nh Gi√° D·ªãch V·ª• - Nh√† h√†ng ·∫®m th·ª±c Bu√¥n M√™ (Phi√™n b·∫£n iOS Wood/Earthy)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <style>
        /* ------------------ BI·∫æN M√ÄU S·∫ÆC CH·ª¶ ƒê·∫†O (WOOD/EARTHY THEME - iOS 5 SAO) ------------------ */
        :root {
            /* T√¥ng m√†u G·ªó/ƒê·∫•t m·ªõi - S√¢u v√† Sang tr·ªçng */
            --wood-dark: #3b2a22; /* M√†u n√¢u s√¥ c√¥ la ƒë·∫≠m - Text ch√≠nh */
            --wood: #5a3f33; /* M√†u n√¢u g·ªó ƒë·∫≠m - Primary Accent */
            --wood-light: #8b5e45; /* M√†u n√¢u g·ªó s√°ng - Accent/Highlight */
            --cream: #f4e6d4; /* N·ªÅn kem/Linen m·ªÅm m·∫°i - Background ch√≠nh */
            --highlight: #ffd99e; /* V√†ng ·∫•m/V√†ng ƒë·ªìng - Active Star */
            
            --ios-primary: var(--wood); 
            --ios-background: var(--cream);
            --ios-light-gray: #d9c7b4; /* M√†u x√°m nh·∫°t cho input/separator - ·∫•m h∆°n */
            --ios-dark-gray: var(--wood-dark); /* M√†u ch·ªØ ch√≠nh */
            --ios-text-secondary: #7e6e61; /* M√†u ch·ªØ ph·ª• (N√¢u x√°m nh·∫°t) */
            --ios-card-bg: #FFFFFF;
            
            /* M√†u ng√¥i sao m·ªõi - V√†ng ·∫•m cho 5 sao */
            --star-color-active: var(--highlight); /* V√†ng ·∫•m/V√†ng ƒë·ªìng */
            --star-color-inactive: var(--ios-light-gray); /* N·ªÅn x√°m nh·∫°t */
            
            /* ƒê·ªãnh nghƒ©a ƒë·ªï b√≥ng m·ªÅm ki·ªÉu iOS - D√πng m√†u n√¢u */
            --ios-shadow-soft: 0 10px 30px rgba(0,0,0,0.1); /* B√≥ng d√†y h∆°n, n·ªïi h∆°n */
            --ios-shadow-button: 0 8px 25px rgba(90, 63, 51, 0.4); /* Shadow t·ª´ m√†u n√¢u ch√≠nh */
            
            /* Bo g√≥c m·ªÅm m·∫°i ki·ªÉu iOS */
            --radius-main-container: 24px; /* Bo g√≥c l·ªõn cho Main Content */
            --radius-card: 26px;
            --radius-input: 18px;
            --radius-button-full: 48px; /* Bo g√≥c full cho floating button */
            --radius-toast: 18px;
            
            /* iOS Easing Function */
            --ios-ease: cubic-bezier(.22,.98,.45,1);
            --ios-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ------------------ C√ÅC PH√âP CHUY·ªÇN ƒê·ªòNG (ANIMATION) ------------------ */

        /* Hi·ªáu ·ª©ng tr∆∞·ª£t l√™n v√† m·ªù d·∫ßn (Fade In Up) */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* HI·ªÜU ·ª®NG NH·∫¢Y L·ªöN KHI CLICK */
        @keyframes starBounce {
            0% { 
                transform: scale(1); 
            }
            50% { 
                transform: scale(1.7); /* N·∫£y l·ªõn h∆°n */
                color: var(--highlight); 
                filter: drop-shadow(0 0 15px var(--highlight)); 
            }
            100% { 
                transform: scale(1.2); 
            }
        }

        /* Pop-up N·∫£y v√†o gi·ªØa m√†n h√¨nh - HI·ªÜU ·ª®NG TR∆Ø·ª¢T RA GI·ªÆA */
        @keyframes toastPopInCenter {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.85); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* M·ªù d·∫ßn v√† thu nh·ªè ƒë·ªÉ ·∫©n */
        @keyframes toastFadeOutCenter {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.85); }
        }
        
        /* --- HI·ªÜU ·ª®NG V·∫º V√íNG TR√íN (DRAWING EFFECT) --- */
        @keyframes drawCircle {
            0% { border-width: 0px; border-color: transparent; transform: scale(0.8); }
            50% { border-width: 3px; border-color: var(--wood-light); transform: scale(1.1); }
            100% { border-width: 3px; border-color: var(--wood-light); transform: scale(1); }
        }

        /* --- HI·ªÜU ·ª®NG V·∫º D·∫§U T√çCH (STROKE EFFECT b·∫±ng clip-path) --- */
        @keyframes drawCheckmark {
            0% { 
                clip-path: inset(100% 100% 0% 0%); /* ·∫®n ho√†n to√†n t·ª´ tr√™n tr√°i */
                opacity: 0.5; /* H∆°i m·ªù l√∫c b·∫Øt ƒë·∫ßu */
            }
            1% { opacity: 1; }
            100% { 
                clip-path: inset(0% 0% 0% 0%); /* Hi·ªán to√†n b·ªô */
                opacity: 1; 
            }
        }


        /* -------------------------- CSS CH√çNH -------------------------- */

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Roboto, sans-serif, 'Inter', Arial, sans-serif;
            background-color: var(--ios-background);
            margin: 0;
            padding: 0;
            color: var(--ios-dark-gray);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }
        
        /* Container Ch√≠nh - Canh gi·ªØa v√† gi·ªõi h·∫°n k√≠ch th∆∞·ªõc */
        .main-container {
            max-width: 580px; /* Max-width tr√™n desktop */
            margin: 0 auto;
            padding: 0 20px 120px 20px; /* Th√™m padding ngang tr·ªü l·∫°i */
        }

        /* iOS Header Style */
        .app-header {
            padding: 40px 0 30px; /* Gi·∫£m padding ngang trong header */
            text-align: center; /* CƒÉn gi·ªØa */
        }
        
        /* Logo Qu√°n */
        .logo-container {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s var(--ios-ease), box-shadow 0.3s var(--ios-ease);
        }

        .logo-container:hover {
             transform: translateY(-4px); 
             box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        #restaurantLogo {
            width: 120px; 
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px; 
            background: linear-gradient(135deg, var(--wood-light), var(--wood)); 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        #restaurantLogo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 16px;
        }
        
        /* Icon d·ª± ph√≤ng */
        #restaurantLogo i {
             font-size: 50px !important;
        }

        .app-header h1 {
            font-size: 2em; 
            font-weight: 900; 
            margin: 0;
            letter-spacing: 0.5px; 
            color: var(--ios-dark-gray);
            line-height: 1.2;
        }
        .app-header p {
            font-size: 1em;
            color: var(--ios-text-secondary);
            margin-top: 10px;
            font-weight: 500;
            max-width: 420px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Employee List - B·ªê C·ª§C GRID XU·ªêNG H√ÄNG */
        .employee-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 c·ªôt tr√™n mobile (m·∫∑c ƒë·ªãnh) */
            gap: 15px; /* Kho·∫£ng c√°ch gi·ªØa c√°c th·∫ª */
            padding: 20px 0 20px 0; /* Lo·∫°i b·ªè padding ngang d∆∞ th·ª´a */
            overflow-x: hidden; /* B·ªè cu·ªôn ngang */
        }
        
        /* Employee Card - TH·∫∫ NH·ªé (PROFILE CARD) */
        .employee-card {
            background-color: var(--ios-card-bg);
            border-radius: var(--radius-card); /* Bo g√≥c m·ªÅm */
            box-shadow: var(--ios-shadow-soft); 
            padding: 15px; /* Gi·∫£m padding */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: auto; 
            transition: transform 0.2s var(--ios-ease), box-shadow 0.2s var(--ios-ease);
            cursor: pointer; 
        }
        
        .employee-card:active {
            transform: scale(0.98); /* Hi·ªáu ·ª©ng b·∫•m nh·∫π */
        }
        
        /* KHUNG ·∫¢NH NH√ÇN VI√äN TR√íN */
        .employee-card img {
            width: 80px; 
            height: 80px;
            border-radius: 50%; /* ·∫¢nh tr√≤n */
            object-fit: cover;
            margin-bottom: 10px;
            margin-top: 0;
            border: 3px solid var(--ios-light-gray); /* Vi·ªÅn nh·∫π */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .employee-card h3 {
            margin: 0;
            font-size: 1em; /* T√™n nh·ªè h∆°n */
            font-weight: 700; 
            /* Cho ph√©p t√™n xu·ªëng d√≤ng */
            white-space: normal; 
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .employee-card p {
            font-size: 0.9em;
            color: var(--wood-light);
            margin: 3px 0 0 0;
            font-weight: 600;
            white-space: nowrap; /* Gi·ªØ ch·ª©c danh kh√¥ng xu·ªëng d√≤ng */
        }

        /* Rating Icons - H·ªÜ TH·ªêNG STAR RATING */
        /* ·∫®N SAO TRONG TH·∫∫ NH√ÇN VI√äN */
        .rating-stars {
            display: flex;
            justify-content: center;
            width: 100%;
            gap: 12px; 
            margin: 30px 0; /* Kho·∫£ng c√°ch trong Modal */
        }
        .employee-card .rating-stars {
            display: none !important; 
        }

        .rating-star {
            font-size: 32px; 
            cursor: pointer;
            color: var(--star-color-inactive); 
            transition: color 0.2s var(--ios-ease), transform 0.25s var(--ios-ease), filter 0.25s var(--ios-ease);
            min-height: 44px; 
            display: flex;
            align-items: center;
        }
        
        /* HI·ªÜU ·ª®NG KHI R√ä CHU·ªòT (HOVER) */
        .rating-star:hover {
            transform: scale(1.1);
            color: var(--highlight);
        }

        /* TR·∫†NG TH√ÅI ƒê√É ƒê∆Ø·ª¢C CH·ªåN (ACTIVE) */
        .rating-star.active {
            color: var(--star-color-active);
            filter: drop-shadow(0 0 4px rgba(255, 217, 158, 0.4)); 
            transform: scale(1.1); /* Gi·ªØ l·ªõn h∆°n m·ªôt ch√∫t ƒë·ªÉ n·ªïi b·∫≠t */
        }

        /* CLASS ƒê·ªÇ K√çCH HO·∫†T HI·ªÜU ·ª®NG N√ÄY */
        .rating-star.star-bounce {
            animation: starBounce 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        
        /* Fixed Feedback Button */
        .feedback-button-fixed {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 36px; 
            background: linear-gradient(180deg, var(--ios-card-bg) 0%, var(--cream) 100%);
            color: var(--wood-dark);
            border: none;
            border-radius: var(--radius-button-full);
            font-size: 1.1em;
            font-weight: 700; 
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1), 0 0 0 1px var(--ios-light-gray); 
            z-index: 1000;
            transition: transform 0.2s var(--ios-ease), box-shadow 0.2s var(--ios-ease);
            display: flex;
            align-items: center;
            gap: 12px; 
            min-height: 55px; 
            letter-spacing: 0.2px;
        }
        
        .feedback-button-fixed:active {
            transform: translateX(-50%) translateY(2px); 
            box-shadow: 5px 15px rgba(0,0,0,0.1); 
        }

        /* -------------------------- TOAST NOTIFICATION STYLE -------------------------- */
        #toastNotification {
            position: fixed;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9); 
            z-index: 2000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 18px 30px; 
            border-radius: var(--radius-toast);
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.2); 
            color: var(--ios-dark-gray);
            font-weight: 600; 
            font-size: 1.1em; 
            display: flex;
            flex-direction: column; 
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: none;
            max-width: 90%;
            text-align: center;
        }

        #toastNotification.show {
            animation: toastPopInCenter 0.4s var(--ios-spring) forwards; 
        }

        #toastNotification.hide {
            animation: toastFadeOutCenter 0.3s ease-out forwards; 
        }
        
        .success-icon-container {
            width: 60px; 
            height: 60px;
            border-radius: 50%;
            border: 3px solid transparent; 
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 5px; 
            background: rgba(139, 94, 69, 0.05); 
            transition: border-color 0.2s;
        }

        .success-check-icon {
            font-size: 2.2em; 
            color: var(--wood-light);
            opacity: 0; 
            transform: scale(1.1);
            clip-path: inset(100% 100% 0% 0%); 
        }

        #toastNotification.show .success-icon-container {
            animation: drawCircle 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.2s forwards; 
        }

        #toastNotification.show .success-check-icon {
            animation: drawCheckmark 0.6s ease-out 0.6s forwards; 
        }

        /* -------------------------- MODAL STYLE -------------------------- */
        .feedback-modal {
            position: fixed;
            z-index: 1001; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.25); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            opacity: 0;
            transition: opacity 0.3s ease-out;
            pointer-events: none; 
        }
        
        .feedback-modal.show {
            opacity: 1;
            pointer-events: auto; 
        }

        .modal-content {
            background-color: var(--ios-card-bg);
            margin: 15vh auto; 
            padding: 30px;
            border-radius: var(--radius-card);
            width: 90%;
            max-width: 480px; 
            box-shadow: var(--ios-shadow-soft);
            position: relative;
            opacity: 0; 
            transform: translateY(50px) scale(0.95);
            transition: transform 0.4s var(--ios-spring), opacity 0.3s ease-out;
        }

        .feedback-modal.show .modal-content {
            opacity: 1;
            transform: translateY(0) scale(1); 
        }

        .modal-content h2 {
            font-size: 1.8em; 
            font-weight: 800;
            margin: 0 0 8px 0;
            color: var(--ios-dark-gray);
        }
        .modal-content p {
            color: var(--ios-text-secondary);
            font-size: 1em;
            margin-bottom: 25px;
        }

        /* Input & Textarea */
        .modal-content textarea {
            width: 100%;
            height: 150px; 
            padding: 20px; 
            margin: 10px 0 25px 0;
            box-sizing: border-box;
            border: 1px solid transparent;
            border-radius: var(--radius-input);
            resize: vertical;
            font-size: 1em;
            font-family: inherit;
            background-color: var(--ios-light-gray); 
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            outline: none;
            color: var(--ios-dark-gray);
        }

        .modal-content textarea:focus {
            border-color: var(--wood-light); 
            box-shadow: 0 0 0 1px var(--wood-light), 0 0 12px rgba(139, 94, 69, 0.15); 
            background-color: var(--ios-card-bg);
        }
        
        /* Modal Submit Button */
        .modal-content button {
            width: 100%;
            background-color: var(--wood);
            color: white;
            padding: 16px;
            border: none;
            border-radius: var(--radius-input); 
            cursor: pointer;
            font-size: 1.15em;
            font-weight: 700;
            transition: transform 0.2s var(--ios-ease), background-color 0.2s;
            min-height: 50px; 
        }

        .modal-content button:active {
            transform: scale(0.98); 
            background-color: var(--wood-dark); 
        }

        .close-button {
            color: var(--ios-text-secondary);
            font-size: 32px;
            font-weight: 200;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
            transition: color 0.2s;
            line-height: 1;
        }

        /* -------------------------- MEDIA QUERIES -------------------------- */

        @media (min-width: 580px) {
            .employee-list {
                grid-template-columns: repeat(4, 1fr); /* 4 c·ªôt tr√™n desktop */
                gap: 20px;
            }
        }
        
        @media (max-width: 580px) {
            .employee-list {
                grid-template-columns: repeat(3, 1fr); /* 3 c·ªôt tr√™n mobile */
                gap: 12px;
            }
            .main-container {
                padding: 0 15px 120px 15px; /* Gi·∫£m padding ngang tr√™n mobile */
            }
            .employee-card {
                padding: 12px 5px;
            }
            .employee-card img {
                width: 70px; 
                height: 70px;
            }
            .employee-card h3 {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>

    <div class="main-container">
        <header class="app-header">
            <div class="logo-container">
                <div id="restaurantLogo">
                    <img src="logobanme.png" 
                         alt="Logo Nh√† h√†ng ·∫®m th·ª±c Bu√¥n M√™" 
                         onerror="this.onerror=null; this.outerHTML='<i class=\'fas fa-utensils\' style=\'font-size: 50px; color: #f4e6d4;\'></i>';" 
                    >
                </div>
                <h1>Nh√† h√†ng ·∫®m th·ª±c Bu√¥n M√™</h1>
            </div>
            <p> S·ª± h√†i l√≤ng c·ªßa qu√Ω kh√°ch l√† ƒë·ªông l·ª±c c·ªßa ch√∫ng t√¥i.</p>
        </header>

        <div class="employee-list" id="employeeList">
            
            <div class="employee-card" data-employee-id="NV001" onclick="openEmployeeRatingModal(this)">
                <img src="nv1.webp" alt="Nguy·ªÖn Th·ªã A" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=A';">
                <h3>Nguy·ªÖn Th·ªã A</h3>
                <p>Ph·ª•c v·ª• B√†n</p>
            </div>
            
            <div class="employee-card" data-employee-id="NV002" onclick="openEmployeeRatingModal(this)">
                <img src="https://images.unsplash.com/photo-1541460395786-c320875e528b?w=900&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDR8fHxlbnwwfHx8fHw%3D" alt="Tr·∫ßn VƒÉn B" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=B';">
                <h3>Tr·∫ßn VƒÉn B</h3>
                <p>Pha Ch·∫ø</p>
            </div>

            <div class="employee-card" data-employee-id="NV003" onclick="openEmployeeRatingModal(this)">
                <img src="https://images.unsplash.com/photo-1627909384594-55581c1f53f3?w=900&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDh8fHxlbnwwfHx8fHw%3D" alt="L√™ Th·ªã C" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=C';">
                <h3>L√™ Th·ªã C</h3>
                <p>Thu Ng√¢n</p>
            </div>
            
            <div class="employee-card" data-employee-id="NV004" onclick="openEmployeeRatingModal(this)">
                <img src="https://images.unsplash.com/photo-1600572836261-2f7b8e11a2f9?w=900&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDF8fHxlbnwwfHx8fHw%3D" alt="Ph·∫°m VƒÉn D" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=D';">
                <h3>Ph·∫°m VƒÉn D</h3>
                <p>Qu·∫£n L√Ω</p>
            </div>
            
            <div class="employee-card" data-employee-id="NV005" onclick="openEmployeeRatingModal(this)">
                <img src="https://images.unsplash.com/photo-1596814510078-433b5c192d6e?q=80&w=900&auto=format&fit=crop" alt="Nguy·ªÖn Th·ªã E" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=E';">
                <h3>Nguy·ªÖn Th·ªã E</h3>
                <p>Ti·∫øp T√¢n</p>
            </div>
            
            <div class="employee-card" data-employee-id="NV006" onclick="openEmployeeRatingModal(this)">
                <img src="https://images.unsplash.com/photo-1627909384594-55581c1f53f3?w=900&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDh8fHxlbnwwfHx8fHw%3D" alt="ƒê·ªó VƒÉn F" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=F';">
                <h3>ƒê·ªó VƒÉn F</h3>
                <p>B·∫£o V·ªá</p>
            </div>
            
        </div>
    </div>

    <button class="feedback-button-fixed" onclick="openFeedbackModal()">
        <i class="fas fa-lightbulb"></i> G√≥p √ù X√¢y D·ª±ng & Ph√°t Tri·ªÉn
    </button>

    <div id="feedbackModal" class="feedback-modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeFeedbackModal()">&times;</span>
            <h2>G√≥p √ù X√¢y D·ª±ng üí°</h2>
            <p>Ch√∫ng t√¥i lu√¥n l·∫Øng nghe. T·∫•t c·∫£ √Ω ki·∫øn c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn ƒë·ªôi ng≈© qu·∫£n l√Ω cao c·∫•p.</p>
            <textarea id="feedbackText" placeholder="Nh·∫≠p g√≥p √Ω v·ªÅ d·ªãch v·ª•, m√≥n ƒÉn, kh√¥ng gian, ho·∫∑c b·∫•t c·ª© ƒëi·ªÅu g√¨ b·∫°n mu·ªën chia s·∫ª..."></textarea>
            <button onclick="submitFeedback()">G·ª≠i G√≥p √ù</button>
        </div>
    </div>
    
    <div id="employeeRatingModal" class="feedback-modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeEmployeeRatingModal()">&times;</span>
            <div id="ratingModalContent" style="text-align: center;">
                
                <div class="employee-info-modal" style="text-align: center;">
                    <img id="ratingEmployeeImage" src="" alt="Employee" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 15px auto 10px; border: 3px solid var(--wood-light);">
                    <h2 style="font-size: 1.8em; margin: 5px 0 0 0;"><span id="ratingEmployeeName"></span></h2>
                    <p id="ratingEmployeeRole" style="margin: 0; color: var(--wood-light); font-weight: 600; font-size: 1.1em;"></p>
                </div>
                
                <p style="margin-top: 30px;">C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ d√†nh th·ªùi gian ƒë√°nh gi√°. Vui l√≤ng ch·ªçn m·ª©c ƒë·ªô h√†i l√≤ng c·ªßa b·∫°n:</p>
                
                <div id="dynamicRatingStars" class="rating-stars">
                    <i class="fas fa-star rating-star" title="1/5: R·∫•t T·ªá" data-rating="1" onclick="submitRatingFromModal(this, 1, 'R·∫•t T·ªá')"></i>
                    <i class="fas fa-star rating-star" title="2/5: Kh√¥ng H√†i L√≤ng" data-rating="2" onclick="submitRatingFromModal(this, 2, 'Kh√¥ng H√†i L√≤ng')"></i>
                    <i class="fas fa-star rating-star" title="3/5: B√¨nh Th∆∞·ªùng" data-rating="3" onclick="submitRatingFromModal(this, 3, 'B√¨nh Th∆∞·ªùng')"></i>
                    <i class="fas fa-star rating-star" title="4/5: H√†i L√≤ng" data-rating="4" onclick="submitRatingFromModal(this, 4, 'H√†i L√≤ng')"></i>
                    <i class="fas fa-star rating-star" title="5/5: Tuy·ªát V·ªùi" data-rating="5" onclick="submitRatingFromModal(this, 5, 'Tuy·ªát V·ªùi')"></i>
                </div>
            </div>
            
        </div>
    </div>
    
    <div id="toastNotification">
        <div class="success-icon-container"> 
            <i class="fas fa-check success-check-icon"></i> 
        </div>
        <span id="toastMessage"></span>
    </div>

    <script type="module">
        // --- FIREBASE IMPORTS (GI·ªÆ NGUY√äN) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // --- FIREBASE CONFIG (GI·ªÆ NGUY√äN) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC4k2DyiEVKXcMpc_j9XwqZG1OHHBNegDk",
            authDomain: "lichnghi-4c665.firebaseapp.com",
            databaseURL: "https://lichnghi-4c665-default-rtdb.firebaseio.com",
            projectId: "lichnghi-4c665",
            storageBucket: "lichnghi-4c665.firebasestorage.app",
            messagingSenderId: "86673813509",
            appId: "1:86673813509:web:168376408dfcbf14e16c6c",
            measurementId: "G-2G08MRQY1V"
        };
        
        // --- KH·ªûI T·∫†O D·ªäCH V·ª§ ---
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        let userId = 'anonymous'; 

        // ƒêƒÉng nh·∫≠p ·∫©n danh
        signInAnonymously(auth).then((userCredential) => {
            userId = userCredential.user.uid;
            console.log("Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p ·∫©n danh. User ID:", userId);
        }).catch((error) => {
            console.error("L·ªói ƒëƒÉng nh·∫≠p ·∫©n danh:", error);
        });

        // --- LOGIC L·∫§Y S·ªê B√ÄN T·ª™ URL ---

        let tableNumber = 'unknown'; 

        function getTableNumberFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const table = urlParams.get('table');
            return table ? table.toUpperCase() : 'UNKNOWN'; 
        }
        
        tableNumber = getTableNumberFromUrl();
        console.log("S·ªë b√†n (Table Number) t·ª´ URL:", tableNumber);

        // --- H√ÄM X·ª¨ L√ù CHUNG ---

        const toastNotification = document.getElementById('toastNotification');
        const toastMessage = document.getElementById('toastMessage');
        let toastTimeout;
        
        let currentRatingEmployee = {};
        const employeeRatingModal = document.getElementById('employeeRatingModal');
        const ratingEmployeeNameElement = document.getElementById('ratingEmployeeName');
        const ratingEmployeeImageElement = document.getElementById('ratingEmployeeImage');
        const ratingEmployeeRoleElement = document.getElementById('ratingEmployeeRole');
        const dynamicRatingStarsContainer = document.getElementById('dynamicRatingStars');
        const feedbackModal = document.getElementById('feedbackModal');
        const feedbackTextarea = document.getElementById('feedbackText');
        
        // **QUAN TR·ªåNG: BI·∫æN CH·∫∂N CLICK K√âP**
        let isSubmitting = false; 
        
        function getVietnamTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: false,
                timeZone: 'Asia/Ho_Chi_Minh' 
            };
            return new Intl.DateTimeFormat('vi-VN', options).format(now);
        }

        function showToast(message) {
            clearTimeout(toastTimeout); 
            
            toastNotification.classList.remove('show');
            toastNotification.classList.remove('hide');

            toastMessage.textContent = message;
            
            setTimeout(() => {
                toastNotification.classList.add('show'); 
            }, 10);
            
            toastTimeout = setTimeout(() => {
                toastNotification.classList.remove('show');
                toastNotification.classList.add('hide'); 
                setTimeout(() => {
                    toastNotification.classList.remove('hide');
                }, 400); 
            }, 3000);
        }

        // --- H√ÄM X·ª¨ L√ù MODAL G√ìP √ù CHUNG (GI·ªÆ NGUY√äN) ---
        window.openFeedbackModal = function() {
            document.body.style.overflow = 'hidden'; 
            feedbackModal.classList.remove('show'); 
            setTimeout(() => {
                feedbackModal.classList.add('show');
            }, 10);
            setTimeout(() => feedbackTextarea.focus(), 350); 
        }

        window.closeFeedbackModal = function() {
            feedbackModal.classList.remove('show');
            document.body.style.overflow = '';
        }
        
        // --- H√ÄM X·ª¨ L√ù MODAL ƒê√ÅNH GI√Å NH√ÇN VI√äN M·ªöI (GI·ªÆ NGUY√äN) ---
        window.openEmployeeRatingModal = function(cardElement) {
            const employeeId = cardElement.getAttribute('data-employee-id');
            const employeeName = cardElement.querySelector('h3').textContent;
            const employeeRole = cardElement.querySelector('p').textContent;
            const employeeImage = cardElement.querySelector('img').src;
            
            currentRatingEmployee = { employeeId, employeeName, employeeRole };
            
            // C·∫≠p nh·∫≠t n·ªôi dung Modal
            ratingEmployeeNameElement.textContent = employeeName;
            ratingEmployeeImageElement.src = employeeImage;
            ratingEmployeeRoleElement.textContent = employeeRole;
            
            // Reset tr·∫°ng th√°i sao
            const stars = dynamicRatingStarsContainer.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.classList.remove('active');
                star.classList.remove('last-selected');
                star.classList.remove('star-bounce'); 
                star.style.pointerEvents = 'auto'; // ƒê·∫£m b·∫£o lu√¥n ƒë∆∞·ª£c click khi modal m·ªü
            });

            // Hi·ªÉn th·ªã modal
            document.body.style.overflow = 'hidden'; 
            employeeRatingModal.classList.add('show');
        }

        window.closeEmployeeRatingModal = function() {
            employeeRatingModal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // --- H√ÄM SUBMIT RATING T·ª™ MODAL V√Ä L∆ØU V√ÄO DB (ƒê√É S·ª¨A L·ªñI T√î M√ÄU V√Ä HI·ªÜU ·ª®NG) ---
        window.submitRatingFromModal = async function(selectedIconElement, rating, mood) {
            
            if (isSubmitting) return; // **NGƒÇN CH·∫∂N DOUBLE CLICK/NHI·ªÄU EVENT**
            isSubmitting = true; 

            const employeeId = currentRatingEmployee.employeeId;
            const employeeName = currentRatingEmployee.employeeName;
            const employeeRole = currentRatingEmployee.employeeRole;
            
            // L·∫•y t·∫•t c·∫£ c√°c ng√¥i sao
            const allStars = dynamicRatingStarsContainer.querySelectorAll('.rating-star');
            
            // 1. Reset tr·∫°ng th√°i: X√≥a t·∫•t c·∫£ hi·ªáu ·ª©ng c≈©
            allStars.forEach(star => {
                star.style.pointerEvents = 'none'; // **QUAN TR·ªåNG: T·∫†M TH·ªúI V√î HI·ªÜU H√ìA CLICK**
                star.classList.remove('active');
                star.classList.remove('last-selected');
                star.classList.remove('star-bounce'); 
            });
            
            // 2. K√≠ch ho·∫°t tr·∫°ng th√°i ACTIVE cho T·∫§T C·∫¢ c√°c sao <= rating
            allStars.forEach(star => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                
                if (starRating <= rating) {
                    star.classList.add('active'); // Th√™m m√†u s√°ng cho sao ƒë√£ ch·ªçn v√† c√°c sao tr∆∞·ªõc ƒë√≥
                }
            });
            
            // 3. Th√™m hi·ªáu ·ª©ng N·∫£y (Bounce) v√†o ng√¥i sao v·ª´a click
            selectedIconElement.classList.add('star-bounce');
            selectedIconElement.classList.add('last-selected');

            // FIREBASE LOGIC
            try {
                const data = {
                    employeeId: employeeId,
                    employeeName: employeeName,
                    employeeRole: employeeRole,
                    rating: rating,
                    mood: mood,
                    timestamp: Date.now(), 
                    vnTime: getVietnamTime(), 
                    userId: userId,
                    tableNumber: tableNumber
                };
                
                const ratingsRef = ref(db, `ratings`);
                await push(ratingsRef, data); 

                // Hi·ªÉn th·ªã toast th√†nh c√¥ng
                showToast(`C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√° ${employeeName} ${rating} sao. Ch√∫ng m√¨nh xin ph√©p ƒë∆∞·ª£c ghi nh·∫≠n ·∫°`);
                console.log(`ƒê√°nh gi√° ${employeeId} ƒë√£ l∆∞u th√†nh c√¥ng v√†o Realtime DB. B√†n: ${tableNumber}`);

                // 4. ƒê√≥ng modal sau khi hi·ªáu ·ª©ng N·∫£y ho√†n t·∫•t (800ms)
                setTimeout(() => {
                    selectedIconElement.classList.remove('star-bounce'); 
                    
                    // **T√ÅI K√çCH HO·∫†T LOGIC**
                    isSubmitting = false;
                    allStars.forEach(star => star.style.pointerEvents = 'auto'); 
                    
                    closeEmployeeRatingModal(); 
                }, 800); 

            } catch (error) {
                console.error("L·ªói khi l∆∞u ƒë√°nh gi√° v√†o Firebase:", error);
                showToast("L·ªói! Kh√¥ng th·ªÉ l∆∞u ƒë√°nh gi√°. Vui l√≤ng th·ª≠ l·∫°i.");
                
                // ƒê·∫£m b·∫£o reset hi·ªáu ·ª©ng v√† tr·∫°ng th√°i ngay c·∫£ khi l·ªói
                selectedIconElement.classList.remove('star-bounce');
                isSubmitting = false;
                allStars.forEach(star => star.style.pointerEvents = 'auto'); 
            }
        }

        // --- H√ÄM G·ª¨I G√ìP √ù V√Ä L∆ØU V√ÄO DB (Gi·ªØ nguy√™n) ---
        window.submitFeedback = async function() {
            const feedback = feedbackTextarea.value.trim();

            if (feedback === "") {
                showToast("Vui l√≤ng nh·∫≠p n·ªôi dung g√≥p √Ω tr∆∞·ªõc khi g·ª≠i!");
                return;
            }

            // FIREBASE LOGIC: L∆∞u g√≥p √Ω
            try {
                const data = {
                    feedback: feedback,
                    timestamp: Date.now(),
                    vnTime: getVietnamTime(),
                    userId: userId,
                    tableNumber: tableNumber 
                };
                
                const feedbackRef = ref(db, 'general_feedback');
                await push(feedbackRef, data); 

                console.log("N·ªôi dung g√≥p √Ω ƒë√£ ƒë∆∞·ª£c l∆∞u:", feedback);
                showToast(`G√≥p √Ω c·ªßa qu√Ω kh√°ch t·∫°i b√†n ${tableNumber} ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n. Xin ch√¢n th√†nh c·∫£m ∆°n!`);
                
                feedbackTextarea.value = '';
                closeFeedbackModal();

            } catch (error) {
                console.error("L·ªói khi l∆∞u g√≥p √Ω v√†o Firebase:", error);
                showToast("L·ªói! Kh√¥ng th·ªÉ g·ª≠i g√≥p √Ω. Vui l√≤ng th·ª≠ l·∫°i.");
            }
        }

        // ƒê√≥ng modal khi click ra ngo√†i khung n·ªôi dung (C·∫≠p nh·∫≠t ƒë·ªÉ bao g·ªìm c·∫£ 2 modal)
        window.onclick = function(event) {
            if (event.target == feedbackModal) {
                window.closeFeedbackModal();
            }
            if (event.target == employeeRatingModal) {
                window.closeEmployeeRatingModal();
            }
        }
    </script>
</body>
</html>
