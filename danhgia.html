<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ƒê√°nh Gi√° D·ªãch V·ª• - Nh√† h√†ng ·∫®m th·ª±c Bu√¥n M√™ (Phi√™n b·∫£n iOS Wood/Earthy)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <style>
        /* ------------------ BI·∫æN M√ÄU S·∫ÆC CH·ª¶ ƒê·∫†O (WOOD/EARTHY THEME - iOS 5 SAO) ------------------ */
        :root {
            /* T√¥ng m√†u G·ªó/ƒê·∫•t m·ªõi - S√¢u v√† Sang tr·ªçng */
            --wood-dark: #3b2a22; /* M√†u n√¢u s√¥ c√¥ la ƒë·∫≠m - Text ch√≠nh */
            --wood: #5a3f33; /* M√†u n√¢u g·ªó ƒë·∫≠m - Primary Accent */
            --wood-light: #8b5e45; /* M√†u n√¢u g·ªó s√°ng - Accent/Highlight */
            --cream: #f4e6d4; /* N·ªÅn kem/Linen m·ªÅm m·∫°i - Background ch√≠nh */
            --highlight: #ffd99e; /* V√†ng ·∫•m/V√†ng ƒë·ªìng - Active Star */
            
            --ios-primary: var(--wood); 
            --ios-background: var(--cream);
            --ios-light-gray: #d9c7b4; /* M√†u x√°m nh·∫°t cho input/separator - ·∫•m h∆°n */
            --ios-dark-gray: var(--wood-dark); /* M√†u ch·ªØ ch√≠nh */
            --ios-text-secondary: #7e6e61; /* M√†u ch·ªØ ph·ª• (N√¢u x√°m nh·∫°t) */
            --ios-card-bg: #FFFFFF;
            
            /* M√†u ng√¥i sao m·ªõi - V√†ng ·∫•m cho 5 sao */
            --star-color-active: var(--highlight); /* V√†ng ·∫•m/V√†ng ƒë·ªìng */
            --star-color-inactive: var(--ios-light-gray); /* N·ªÅn x√°m nh·∫°t */
            
            /* ƒê·ªãnh nghƒ©a ƒë·ªï b√≥ng m·ªÅm ki·ªÉu iOS - D√πng m√†u n√¢u */
            --ios-shadow-soft: 0 10px 30px rgba(0,0,0,0.1); /* B√≥ng d√†y h∆°n, n·ªïi h∆°n */
            --ios-shadow-button: 0 8px 25px rgba(90, 63, 51, 0.4); /* Shadow t·ª´ m√†u n√¢u ch√≠nh */
            
            /* Bo g√≥c m·ªÅm m·∫°i ki·ªÉu iOS */
            --radius-main-container: 24px; /* Bo g√≥c l·ªõn cho Main Content */
            --radius-card: 26px;
            --radius-input: 18px;
            --radius-button-full: 48px; /* Bo g√≥c full cho floating button */
            --radius-toast: 18px;
            
            /* iOS Easing Function */
            --ios-ease: cubic-bezier(.22,.98,.45,1);
            --ios-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ------------------ C√ÅC PH√âP CHUY·ªÇN ƒê·ªòNG (ANIMATION) ------------------ */

        /* Hi·ªáu ·ª©ng tr∆∞·ª£t l√™n v√† m·ªù d·∫ßn (Fade In Up) */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* HI·ªÜU ·ª®NG NH·∫¢Y L·ªöN KHI CLICK */
        @keyframes starBounce {
            0% { 
                transform: scale(1); 
            }
            50% { 
                transform: scale(1.7); /* N·∫£y l·ªõn h∆°n */
                color: var(--highlight); 
                filter: drop-shadow(0 0 15px var(--highlight)); 
            }
            100% { 
                transform: scale(1.2); 
            }
        }

        /* Pop-up N·∫£y v√†o v·ªã tr√≠ M·ªöI (TOP: 33%) */
        @keyframes toastPopInTop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.85); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* M·ªù d·∫ßn v√† thu nh·ªè ƒë·ªÉ ·∫©n */
        @keyframes toastFadeOutTop {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.85); }
        }
        
        /* --- HI·ªÜU ·ª®NG V·∫º V√íNG TR√íN (DRAWING EFFECT) --- */
        @keyframes drawCircle {
            0% { border-width: 0px; border-color: transparent; transform: scale(0.8); }
            50% { border-width: 3px; border-color: var(--wood-light); transform: scale(1.1); }
            100% { border-width: 3px; border-color: var(--wood-light); transform: scale(1); }
        }

        /* --- HI·ªÜU ·ª®NG V·∫º D·∫§U T√çCH (STROKE EFFECT b·∫±ng clip-path) --- */
        @keyframes drawCheckmark {
            0% { 
                clip-path: inset(100% 100% 0% 0%); /* ·∫®n ho√†n to√†n t·ª´ tr√™n tr√°i */
                opacity: 0.5; /* H∆°i m·ªù l√∫c b·∫Øt ƒë·∫ßu */
            }
            1% { opacity: 1; }
            100% { 
                clip-path: inset(0% 0% 0% 0%); /* Hi·ªán to√†n b·ªô */
                opacity: 1; 
            }
        }


        /* -------------------------- CSS CH√çNH -------------------------- */

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Roboto, sans-serif, 'Inter', Arial, sans-serif;
            background-color: var(--ios-background);
            margin: 0;
            padding: 0;
            color: var(--ios-dark-gray);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }
        
        /* CSS C·∫¨P NH·∫¨T: Th√™m l·∫°i c√°c l·ªõp animation b·ªã thi·∫øu */
        .animated-element {
            opacity: 0;
            transform: translateY(25px); /* B·∫Øt ƒë·∫ßu t·ª´ d∆∞·ªõi l√™n */
            transition: opacity 1.0s var(--ios-ease), transform 1.0s var(--ios-ease);
        }

        .animated-element.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Container Ch√≠nh - Canh gi·ªØa v√† gi·ªõi h·∫°n k√≠ch th∆∞·ªõc */
        .main-container {
            max-width: 580px; /* Max-width tr√™n desktop */
            margin: 0 auto;
            padding: 0 20px 120px 20px; /* Th√™m padding ngang tr·ªü l·∫°i */
        }

        /* iOS Header Style */
        .app-header {
            padding: 40px 0 30px; /* Gi·∫£m padding ngang trong header */
            text-align: center; /* CƒÉn gi·ªØa */
        }
        
        /* Logo Qu√°n */
        .logo-container {
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s var(--ios-ease), box-shadow 0.3s var(--ios-ease);
        }

        .logo-container:hover {
             transform: translateY(-4px); 
             box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        #restaurantLogo {
            width: 120px; 
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px; 
            background: linear-gradient(135deg, var(--wood-light), var(--wood)); 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        #restaurantLogo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 16px;
        }
        
        /* Icon d·ª± ph√≤ng */
        #restaurantLogo i {
             font-size: 50px !important;
        }

        .app-header h1 {
            font-size: 2em; 
            font-weight: 900; 
            margin: 0;
            letter-spacing: 0.5px; 
            color: var(--ios-dark-gray);
            line-height: 1.2;
        }
        .app-header p {
            font-size: 1em;
            color: var(--ios-text-secondary);
            margin-top: 10px;
            font-weight: 500;
            max-width: 420px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Employee List - B·ªê C·ª§C GRID XU·ªêNG H√ÄNG */
        .employee-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 c·ªôt tr√™n mobile (m·∫∑c ƒë·ªãnh) */
            gap: 15px; /* Kho·∫£ng c√°ch gi·ªØa c√°c th·∫ª */
            padding: 20px 0 20px 0; /* Lo·∫°i b·ªè padding ngang d∆∞ th·ª´a */
            overflow-x: hidden; /* B·ªè cu·ªôn ngang */
        }
        
        /* Employee Card - TH·∫∫ NH·ªé (PROFILE CARD) */
        /* TH√äM animated-element V√ÄO ƒê√ÇY ƒê·ªÇ T·ª™NG TH·∫∫ LOAD RI√äNG */
        .employee-card {
            background-color: var(--ios-card-bg);
            border-radius: var(--radius-card); /* Bo g√≥c m·ªÅm */
            box-shadow: var(--ios-shadow-soft); 
            padding: 15px; /* Gi·∫£m padding */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: auto; 
            transition: transform 0.2s var(--ios-ease), box-shadow 0.2s var(--ios-ease);
            cursor: pointer; 
        }
        
        .employee-card:active {
            transform: scale(0.98); /* Hi·ªáu ·ª©ng b·∫•m nh·∫π */
        }
        
        /* [THAY ƒê·ªîI QUAN TR·ªåNG] KHUNG ·∫¢NH NH√ÇN VI√äN - CHUY·ªÇN L·∫†I V·ªÄ H√åNH TR√íN V√Ä L·∫§P ƒê·∫¶Y */
        .employee-card img {
            width: 80px; 
            height: 80px;
            /* ƒê√É S·ª¨A: Chuy·ªÉn l·∫°i v·ªÅ h√¨nh tr√≤n ƒë·ªÉ c√≥ t√≠nh th·∫©m m·ªπ profile h∆°n */
            border-radius: 50%; 
            /* ƒê√É S·ª¨A: D√πng 'cover' ƒë·ªÉ L·∫§P ƒê·∫¶Y 100% khung, KH√îNG C√íN KHO·∫¢NG TR·∫ÆNG */
            object-fit: cover; 
            background-color: transparent; 
            margin-bottom: 10px;
            margin-top: 0;
            border: 3px solid var(--ios-light-gray); /* Vi·ªÅn nh·∫π */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .employee-card h3 {
            margin: 0;
            font-size: 1em; /* T√™n nh·ªè h∆°n */
            font-weight: 700; 
            /* Cho ph√©p t√™n xu·ªëng d√≤ng */
            white-space: normal; 
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .employee-card p {
            font-size: 0.9em;
            color: var(--wood-light);
            margin: 3px 0 0 0;
            font-weight: 600;
            white-space: nowrap; /* Gi·ªØ ch·ª©c danh kh√¥ng xu·ªëng d√≤ng */
        }

        /* Rating Icons - H·ªÜ TH·ªêNG ICON C·∫¢M X√öC */
        /* ·∫®N ICON TRONG TH·∫∫ NH√ÇN VI√äN */
        .employee-card .rating-stars {
            display: none !important; 
        }

        .rating-stars {
            display: flex;
            justify-content: space-around; /* ƒê√É S·ª¨A: Ph√¢n b·ªë ƒë·ªÅu icon */
            width: 100%;
            max-width: 250px; /* ƒê√É S·ª¨A: Gi·ªõi h·∫°n chi·ªÅu r·ªông ƒë·ªÉ 2 icon x√≠ch l·∫°i g·∫ßn nhau */
            margin: 30px auto; /* ƒê√É S·ª¨A: CƒÉn gi·ªØa kh·ªëi rating */
            padding: 0; 
        }
        
        .rating-star {
            font-size: 50px; /* ƒê√É S·ª¨A: TƒÉng k√≠ch th∆∞·ªõc icon */
            cursor: pointer;
            color: var(--ios-text-secondary); /* D√πng m√†u x√°m ·∫•m cho tr·∫°ng th√°i inactive */
            transition: color 0.2s var(--ios-ease), transform 0.25s var(--ios-ease), filter 0.25s var(--ios-ease);
            
            /* FIX TRI·ªÜT ƒê·ªÇ: V√πng b·∫•m ri√™ng bi·ªát v√† r√µ r√†ng */
            position: relative; 
            z-index: 1000; 
            padding: 15px; /* V√πng b·∫•m l·ªõn */
            margin: 0; 
            display: inline-block; 
            line-height: 1; 
            text-align: center;
        }
        
        /* HI·ªÜU ·ª®NG KHI R√ä CHU·ªòT (HOVER) */
        .rating-star:hover {
            transform: scale(1.1);
            color: var(--highlight);
        }

        /* TR·∫†NG TH√ÅI ƒê√É ƒê∆Ø·ª¢C CH·ªåN (ACTIVE) */
        .rating-star.active {
            color: var(--highlight); /* M√†u v√†ng ·∫•m cho H√†i L√≤ng */
            filter: drop-shadow(0 0 4px rgba(255, 217, 158, 0.4)); 
            transform: scale(1.1);
        }
        
        /* M√†u ri√™ng cho icon Kh√¥ng H√†i L√≤ng */
        .rating-star.frown.active {
            color: var(--wood); /* M√†u n√¢u g·ªó ƒë·∫≠m cho Kh√¥ng H√†i L√≤ng */
            filter: drop-shadow(0 0 4px rgba(90, 63, 51, 0.4));
        }

        /* CLASS ƒê·ªÇ K√çCH HO·∫†T HI·ªÜU ·ª®NG N√ÄY */
        .rating-star.star-bounce {
            animation: starBounce 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        
        /* Fixed Feedback Button - ƒê√É S·ª¨A V√Ä CƒÇN GI·ªÆA TUY·ªÜT ƒê·ªêI */
        .feedback-button-fixed {
            position: fixed;
            bottom: 30px;
            left: 50%; /* ƒê·∫£m b·∫£o n√∫t b·∫Øt ƒë·∫ßu t·ª´ gi·ªØa */
            transform: translateX(-50%); /* K√©o n√∫t l√πi v·ªÅ 50% chi·ªÅu r·ªông c·ªßa n√≥ ƒë·ªÉ cƒÉn gi·ªØa ho√†n h·∫£o */
            padding: 16px 36px; 
            background: linear-gradient(180deg, var(--ios-card-bg) 0%, var(--cream) 100%);
            color: var(--wood-dark);
            border: none;
            border-radius: var(--radius-button-full);
            font-size: 1.1em;
            font-weight: 700; 
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1), 0 0 0 1px var(--ios-light-gray); 
            z-index: 1000;
            transition: transform 0.2s var(--ios-ease), box-shadow 0.2s var(--ios-ease);
            display: flex;
            align-items: center;
            gap: 12px; 
            min-height: 55px; 
            letter-spacing: 0.2px;
            
            /* ƒê·∫¢M B·∫¢O N√öT HI·ªÜN NGAY L·∫¨P T·ª®C */
            opacity: 1;
        }
        
        .feedback-button-fixed:active {
            transform: translateX(-50%) translateY(2px); /* Duy tr√¨ cƒÉn gi·ªØa khi nh·∫•n */
            box-shadow: 5px 15px rgba(0,0,0,0.1); 
        }

        /* -------------------------- TOAST NOTIFICATION STYLE (ƒê√É S·ª¨A V·ªä TR√ç) -------------------------- */
        #toastNotification {
            position: fixed;
            /* ƒê√É S·ª¨A: ƒê·∫∑t ·ªü v·ªã tr√≠ 1/3 t·ª´ tr√™n xu·ªëng (2/3 m√†n h√¨nh t·ª´ d∆∞·ªõi l√™n) */
            top: 33%; 
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9); 
            z-index: 2000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 18px 30px; 
            border-radius: var(--radius-toast);
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.2); 
            color: var(--ios-dark-gray);
            font-weight: 600; 
            font-size: 1.1em; 
            display: flex;
            flex-direction: column; 
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: none;
            max-width: 90%;
            text-align: center;
        }

        /* D√πng animation m·ªõi ƒë·ªÉ ƒë·∫£m b·∫£o n√≥ n·∫£y v√†o v·ªã tr√≠ TOP: 33% */
        #toastNotification.show {
            animation: toastPopInTop 0.4s var(--ios-spring) forwards; 
        }

        #toastNotification.hide {
            animation: toastFadeOutTop 0.3s ease-out forwards; 
        }
        
        .success-icon-container {
            width: 60px; 
            height: 60px;
            border-radius: 50%;
            border: 3px solid transparent; 
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 5px; 
            background: rgba(139, 94, 69, 0.05); 
            transition: border-color 0.2s;
        }

        .success-check-icon {
            font-size: 2.2em; 
            color: var(--wood-light);
            opacity: 0; 
            transform: scale(1.1);
            clip-path: inset(100% 100% 0% 0%); 
        }

        #toastNotification.show .success-icon-container {
            animation: drawCircle 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.2s forwards; 
        }

        #toastNotification.show .success-check-icon {
            animation: drawCheckmark 0.6s ease-out 0.6s forwards; 
        }

        /* -------------------------- MODAL STYLE -------------------------- */
        .feedback-modal {
            position: fixed;
            z-index: 1001; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.25); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            opacity: 0;
            transition: opacity 0.3s ease-out;
            pointer-events: none; 
        }
        
        .feedback-modal.show {
            opacity: 1;
            pointer-events: auto; 
        }

        .modal-content {
            background-color: var(--ios-card-bg);
            margin: 15vh auto; 
            padding: 30px;
            border-radius: var(--radius-card);
            width: 90%;
            max-width: 480px; 
            box-shadow: var(--ios-shadow-soft);
            position: relative;
            opacity: 0; 
            transform: translateY(50px) scale(0.95);
            transition: transform 0.4s var(--ios-spring), opacity 0.3s ease-out;
        }

        .feedback-modal.show .modal-content {
            opacity: 1;
            transform: translateY(0) scale(1); 
        }

        .modal-content h2 {
            font-size: 1.8em; 
            font-weight: 800;
            margin: 0 0 8px 0;
            color: var(--ios-dark-gray);
        }
        .modal-content p {
            color: var(--ios-text-secondary);
            font-size: 1em;
            margin-bottom: 25px;
        }

        /* Input & Textarea */
        .modal-content textarea {
            width: 100%;
            height: 150px; 
            padding: 20px; 
            margin: 10px 0 25px 0;
            box-sizing: border-box;
            border: 1px solid transparent;
            border-radius: var(--radius-input);
            resize: vertical;
            font-size: 1em;
            font-family: inherit;
            background-color: var(--ios-light-gray); 
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            outline: none;
            color: var(--ios-dark-gray);
        }

        .modal-content textarea:focus {
            border-color: var(--wood-light); 
            box-shadow: 0 0 0 1px var(--wood-light), 0 0 12px rgba(139, 94, 69, 0.15); 
            background-color: var(--ios-card-bg);
        }
        
        /* Modal Submit Button */
        .modal-content button {
            width: 100%;
            background-color: var(--wood);
            color: white;
            padding: 16px;
            border: none;
            border-radius: var(--radius-input); 
            cursor: pointer;
            font-size: 1.15em;
            font-weight: 700;
            transition: transform 0.2s var(--ios-ease), background-color 0.2s;
            min-height: 50px; 
        }
        
        /* Modal Submit Button D√ÄNH CHO N√öT H·ª¶Y */
        .modal-content button:nth-of-type(2) {
             background-color: transparent !important;
             color: var(--ios-text-secondary) !important;
             font-weight: 500 !important;
             padding: 10px 16px !important;
        }


        .modal-content button:active {
            transform: scale(0.98); 
            background-color: var(--wood-dark); 
        }
        
        /* Fix cho n√∫t h·ªßy khi active */
        .modal-content button:nth-of-type(2):active {
            transform: scale(0.98);
            background-color: rgba(0, 0, 0, 0.05) !important; 
        }

        .close-button {
            color: var(--ios-text-secondary);
            font-size: 32px;
            font-weight: 200;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
            transition: color 0.2s;
            line-height: 1;
        }
        
        /* [THAY ƒê·ªîI QUAN TR·ªåNG] KHUNG ·∫¢NH NH√ÇN VI√äN TRONG MODAL */
        #ratingEmployeeImage {
            width: 100px; 
            height: 100px; 
            /* ƒê√É S·ª¨A: Chuy·ªÉn l·∫°i v·ªÅ h√¨nh tr√≤n ƒë·ªÉ l·∫•p ƒë·∫ßy */
            border-radius: 50% !important; 
            /* ƒê√É S·ª¨A: D√πng 'cover' ƒë·ªÉ L·∫§P ƒê·∫¶Y 100% khung, KH√îNG C√íN KHO·∫¢NG TR·∫ÆNG */
            object-fit: cover !important; 
            background-color: transparent; 
            margin: 15px auto 10px !important; 
            border: 3px solid var(--wood-light) !important;
        }


        /* -------------------------- MEDIA QUERIES -------------------------- */

        @media (min-width: 580px) {
            .employee-list {
                grid-template-columns: repeat(4, 1fr); /* 4 c·ªôt tr√™n desktop */
                gap: 20px;
            }
        }
        
        @media (max-width: 580px) {
            .employee-list {
                grid-template-columns: repeat(3, 1fr); /* 3 c·ªôt tr√™n mobile */
                gap: 12px;
            }
            .main-container {
                padding: 0 15px 120px 15px; /* Gi·∫£m padding ngang tr√™n mobile */
            }
            .employee-card {
padding: 40px 5px;            }
            .employee-card img {
                width: 100px; 
                height: 100px;
            }
            .employee-card h3 {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>

    <div class="main-container">
        <header class="app-header animated-element">
            <div class="logo-container">
                <div id="restaurantLogo">
                    <img src="logobanme.png" 
                         alt="Logo Nh√† h√†ng ·∫®m th·ª±c Bu√¥n M√™" 
                         onerror="this.onerror=null; this.outerHTML='<i class=\'fas fa-utensils\' style=\'font-size: 50px; color: #f4e6d4;\'></i>';" 
                    >
                </div>
                <h1>Nh√† h√†ng ·∫®m th·ª±c Bu√¥n M√™</h1>
            </div>
            <p> S·ª± h√†i l√≤ng c·ªßa qu√Ω kh√°ch l√† ƒë·ªông l·ª±c c·ªßa ch√∫ng t√¥i.</p>
        </header>

        <div class="employee-list" id="employeeList">
            
            <div class="employee-card animated-element" data-employee-id="NV001" onclick="openEmployeeRatingModal(this)">
                <img src="nv3.jpg" alt="Nguy·ªÖn Th·ªã A" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=A';">
                <h3>Nguy·ªÖn Tu·∫•n ƒê·∫°t</h3>
                <p>Gi√°m s√°t</p>
            </div>
            
            <div class="employee-card animated-element" data-employee-id="NV002" onclick="openEmployeeRatingModal(this)">
                <img src="nv4.jpg" alt="Tr·∫ßn VƒÉn B" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=B';">
                <h3>Tr∆∞∆°ng B√° L√¢n</h3>
                <p>B·∫£o v·ªá</p>
            </div>

            <div class="employee-card animated-element" data-employee-id="NV003" onclick="openEmployeeRatingModal(this)">
                <img src="nv5.jpg" alt="L√™ Th·ªã C" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=C';">
                <h3>T·∫° Th·ªã Ho√†i Uy√™n</h3>
                <p>Qu·∫£n L√Ω</p>
            </div>
            
            <div class="employee-card animated-element" data-employee-id="NV004" onclick="openEmployeeRatingModal(this)">
                <img src="nv6.jpg" alt="Ph·∫°m VƒÉn D" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=D';">
                <h3>Ph·∫°m Ho√†ng Thanh Ng√¢n </h3>
                <p>L·ªÖ T√¢n</p>
            </div>
            
            <div class="employee-card animated-element" data-employee-id="NV005" onclick="openEmployeeRatingModal(this)">
                <img src="nv7.jpg" alt="Nguy·ªÖn Th·ªã E" onerror="this.onerror=null; this.src='https://placehold.co/100x100/E0D9D4/3E2723?text=E';">
                <h3>Tr·∫ßn Hu·ª≥nh Phi Y·∫øn</h3>
                <p>L·ªÖ T√¢n</p>
            </div>
           
            
        </div>
    </div>

    <button class="feedback-button-fixed" onclick="openFeedbackModal()">
        <i class="fas fa-lightbulb"></i> G√≥p √ù X√¢y D·ª±ng & Ph√°t Tri·ªÉn
    </button>

    <div id="feedbackModal" class="feedback-modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeFeedbackModal()">&times;</span>
            <h2>G√≥p √ù X√¢y D·ª±ng üí°</h2>
            <p>Ch√∫ng t√¥i lu√¥n l·∫Øng nghe. T·∫•t c·∫£ √Ω ki·∫øn c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn ƒë·ªôi ng≈© qu·∫£n l√Ω cao c·∫•p.</p>
            <textarea id="feedbackText" placeholder="Nh·∫≠p g√≥p √Ω v·ªÅ d·ªãch v·ª•, m√≥n ƒÉn, kh√¥ng gian, ho·∫∑c b·∫•t c·ª© ƒëi·ªÅu g√¨ b·∫°n mu·ªën chia s·∫ª..."></textarea>
            <button onclick="submitFeedback()">G·ª≠i G√≥p √ù</button>
        </div>
    </div>
    
    <div id="employeeRatingModal" class="feedback-modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeEmployeeRatingModal()">&times;</span>
            <div id="ratingModalContent" style="text-align: center;">
                
                <div class="employee-info-modal" style="text-align: center;">
                    <img id="ratingEmployeeImage" src="" alt="Employee" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; background-color: transparent; margin: 15px auto 10px; border: 3px solid var(--wood-light);">
                    <h2 style="font-size: 1.8em; margin: 5px 0 0 0;"><span id="ratingEmployeeName"></span></h2>
                    <p id="ratingEmployeeRole" style="margin: 0; color: var(--wood-light); font-weight: 600; font-size: 1.1em;"></p>
                </div>
                
                <p id="ratingPrompt" style="margin-top: 30px;">C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ d√†nh th·ªùi gian ƒë√°nh gi√°. Vui l√≤ng ch·ªçn m·ª©c ƒë·ªô h√†i l√≤ng c·ªßa b·∫°n:</p>
                
                <div id="dynamicRatingStars" class="rating-stars">
                    <i class="fas fa-face-frown rating-star frown" 
                       title="Kh√¥ng H√†i L√≤ng" 
                       data-rating="1" 
                       onclick="handleRatingSelection(this, 1, 'Kh√¥ng H√†i L√≤ng')">
                    </i>
                    <i class="fas fa-face-smile rating-star" 
                       title="H√†i L√≤ng" 
                       data-rating="3" 
                       onclick="handleRatingSelection(this, 3, 'H√†i L√≤ng')">
                    </i>
                </div>
                
                <div id="employeeFeedbackArea" style="display: none;">
                    <p style="margin: 25px 0 15px 0; font-weight: 600; color: var(--wood-dark);">Vui l√≤ng cho ch√∫ng t√¥i bi·∫øt t·∫°i sao b·∫°n ch∆∞a h√†i l√≤ng:</p>
                    <textarea id="employeeFeedbackText" placeholder="Nh·∫≠p g√≥p √Ω c·ª• th·ªÉ v·ªÅ nh√¢n vi√™n..." style="height: 100px;"></textarea>
                    <button onclick="submitEmployeeFeedback()">G·ª≠i G√≥p √ù C·ª• Th·ªÉ</button>
                    <button onclick="closeEmployeeRatingModal()">H·ªßy v√† ƒê√≥ng</button>
                </div>
                </div>
            
        </div>
    </div>
    
    <div id="toastNotification">
        <div class="success-icon-container"> 
            <i class="fas fa-check success-check-icon"></i> 
        </div>
        <span id="toastMessage"></span>
    </div>

    <script type="module">
        // --- FIREBASE IMPORTS (GI·ªÆ NGUY√äN) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // --- FIREBASE CONFIG (GI·ªÆ NGUY√äN) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC4k2DyiEVKXcMpc_j9XwqZG1OHHBNegDk",
            authDomain: "lichnghi-4c665.firebaseapp.com",
            databaseURL: "https://lichnghi-4c665-default-rtdb.firebaseio.com",
            projectId: "lichnghi-4c665",
            storageBucket: "lichnghi-4c665.firebase-storage.app",
            messagingSenderId: "86673813509",
            appId: "1:86673813509:web:168376408dfcbf14e16c6c",
            measurementId: "G-2G08MRQY1V"
        };
        
        // --- KH·ªûI T·∫†O D·ªäCH V·ª§ ---
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        let userId = 'anonymous'; 

        // ƒêƒÉng nh·∫≠p ·∫©n danh
        signInAnonymously(auth).then((userCredential) => {
            userId = userCredential.user.uid;
            console.log("Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p ·∫©n danh. User ID:", userId);
        }).catch((error) => {
            console.error("L·ªói ƒëƒÉng nh·∫≠p ·∫©n danh:", error);
        });

        // --- LOGIC L·∫§Y S·ªê B√ÄN T·ª™ URL ---

        let tableNumber = 'unknown'; 

        function getTableNumberFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const table = urlParams.get('table');
            return table ? table.toUpperCase() : 'UNKNOWN'; 
        }
        
        tableNumber = getTableNumberFromUrl();
        console.log("S·ªë b√†n (Table Number) t·ª´ URL:", tableNumber);

        // --- H√ÄM X·ª¨ L√ù CHUNG ---

        const toastNotification = document.getElementById('toastNotification');
        const toastMessage = document.getElementById('toastMessage');
        let toastTimeout;
        
        let currentRatingEmployee = {};
        const employeeRatingModal = document.getElementById('employeeRatingModal');
        const ratingEmployeeNameElement = document.getElementById('ratingEmployeeName');
        const ratingEmployeeImageElement = document.getElementById('ratingEmployeeImage');
        const ratingEmployeeRoleElement = document.getElementById('ratingEmployeeRole');
        const dynamicRatingStarsContainer = document.getElementById('dynamicRatingStars');
        
        // TH√äM M·ªöI: C√°c element cho t√≠nh nƒÉng feedback
        const employeeFeedbackArea = document.getElementById('employeeFeedbackArea');
        const employeeFeedbackTextarea = document.getElementById('employeeFeedbackText');
        const ratingPrompt = document.getElementById('ratingPrompt');

        const feedbackModal = document.getElementById('feedbackModal');
        const feedbackTextarea = document.getElementById('feedbackText');
        
        
        function getVietnamTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: false,
                timeZone: 'Asia/Ho_Chi_Minh' 
            };
            return new Intl.DateTimeFormat('vi-VN', options).format(now);
        }

        function showToast(message) {
            clearTimeout(toastTimeout); 
            
            toastNotification.classList.remove('show');
            toastNotification.classList.remove('hide');

            toastMessage.textContent = message;
            
            setTimeout(() => {
                toastNotification.classList.add('show'); 
            }, 10);
            
            toastTimeout = setTimeout(() => {
                toastNotification.classList.remove('show');
                toastNotification.classList.add('hide'); 
                setTimeout(() => {
                    toastNotification.classList.remove('hide');
                }, 400); 
            }, 3000);
        }

        // --- H√ÄM X·ª¨ L√ù MODAL G√ìP √ù CHUNG (GI·ªÆ NGUY√äN) ---
        window.openFeedbackModal = function() {
            document.body.style.overflow = 'hidden'; 
            feedbackModal.classList.remove('show'); 
            setTimeout(() => {
                feedbackModal.classList.add('show');
            }, 10);
            setTimeout(() => feedbackTextarea.focus(), 350); 
        }

        window.closeFeedbackModal = function() {
            feedbackModal.classList.remove('show');
            document.body.style.overflow = '';
        }
        
        // --- H√ÄM X·ª¨ L√ù MODAL ƒê√ÅNH GI√Å NH√ÇN VI√äN M·ªöI (C·∫¨P NH·∫¨T R·∫§T QUAN TR·ªåNG) ---
        window.closeEmployeeRatingModal = function() {
            // FIX L·ªñI: Lu√¥n ƒë·∫£m b·∫£o reset tr·∫°ng th√°i hi·ªÉn th·ªã b√™n trong modal khi ƒë√≥ng
            employeeFeedbackArea.style.display = 'none'; // ·∫®n khu v·ª±c g√≥p √Ω chi ti·∫øt
            dynamicRatingStarsContainer.style.display = 'flex'; // Hi·ªán l·∫°i khu v·ª±c icon
            
            // X√≥a tr·∫°ng th√°i active c·ªßa icon
            const stars = dynamicRatingStarsContainer.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.classList.remove('active');
                star.classList.remove('last-selected');
                star.classList.remove('star-bounce'); 
                star.style.pointerEvents = 'auto'; 
            });
            
            // ƒê√≥ng modal ch√≠nh
            employeeRatingModal.classList.remove('show');
            document.body.style.overflow = '';
        }
        
        window.openEmployeeRatingModal = function(cardElement) {
            const employeeId = cardElement.getAttribute('data-employee-id');
            const employeeName = cardElement.querySelector('h3').textContent;
            const employeeRole = cardElement.querySelector('p').textContent;
            const employeeImage = cardElement.querySelector('img').src;
            
            currentRatingEmployee = { employeeId, employeeName, employeeRole };
            
            // C·∫≠p nh·∫≠t n·ªôi dung Modal
            ratingEmployeeNameElement.textContent = employeeName;
            ratingEmployeeImageElement.src = employeeImage;
            ratingEmployeeRoleElement.textContent = employeeRole;
            
            // TH√äM M·ªöI: Reset feedback area v√† prompt (ƒë·∫£m b·∫£o hi·ªÉn th·ªã ƒë√∫ng khu v·ª±c)
            employeeFeedbackArea.style.display = 'none';
            employeeFeedbackTextarea.value = '';
            ratingPrompt.style.display = 'block'; 
            dynamicRatingStarsContainer.style.display = 'flex'; // Hi·ªán khu v·ª±c icon khi m·ªü

            // Reset tr·∫°ng th√°i sao
            const stars = dynamicRatingStarsContainer.querySelectorAll('.rating-star');
            stars.forEach(star => {
                star.classList.remove('active');
                star.classList.remove('last-selected');
                star.classList.remove('star-bounce'); 
                star.style.pointerEvents = 'auto'; 
            });
            
            dynamicRatingStarsContainer.style.pointerEvents = 'auto';

            // Hi·ªÉn th·ªã modal
            document.body.style.overflow = 'hidden'; 
            employeeRatingModal.classList.add('show');
        }


        // --- H√ÄM X·ª¨ L√ù CH·ªåN RATING M·ªöI (handleRatingSelection) ---
        window.handleRatingSelection = async function(selectedIconElement, rating, mood) {
            
            // L·∫•y t·∫•t c·∫£ c√°c ng√¥i sao
            const allStars = dynamicRatingStarsContainer.querySelectorAll('.rating-star');
            
            // 1. Reset tr·∫°ng th√°i: X√≥a t·∫•t c·∫£ hi·ªáu ·ª©ng c≈©
            allStars.forEach(star => {
                star.classList.remove('active');
                star.classList.remove('last-selected');
                star.classList.remove('star-bounce'); 
            });

            // K√≠ch ho·∫°t tr·∫°ng th√°i ACTIVE cho ch·ªâ icon ƒë∆∞·ª£c ch·ªçn
            selectedIconElement.classList.add('active');
            selectedIconElement.classList.add('star-bounce'); 
            selectedIconElement.classList.add('last-selected');
            
            // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ c√°c icon ƒë·ªÉ tr√°nh click k√©p trong qu√° tr√¨nh x·ª≠ l√Ω/animation
            allStars.forEach(star => star.style.pointerEvents = 'none'); 

            if (rating === 3) {
                // --- TR∆Ø·ªúNG H·ª¢P H√ÄI L√íNG (SMILE - 3 sao): L∆ØU NGAY ---
                
                try {
                    const data = {
                        employeeId: currentRatingEmployee.employeeId,
                        employeeName: currentRatingEmployee.employeeName,
                        employeeRole: currentRatingEmployee.employeeRole,
                        rating: rating,
                        mood: mood,
                        timestamp: Date.now(), 
                        vnTime: getVietnamTime(), 
                        userId: userId,
                        tableNumber: tableNumber
                    };
                    
                    const ratingsRef = ref(db, `ratings`);
                    await push(ratingsRef, data); 

                    const toastMessage = `C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√°. Ch√∫ng m√¨nh xin ph√©p ƒë∆∞·ª£c ghi nh·∫≠n ·∫°`;
                    
                    // ƒê√≥ng modal ngay l·∫≠p t·ª©c (Modal c√≥ animation 0.4s). H√†m n√†y ƒë√£ reset tr·∫°ng th√°i sao.
                    closeEmployeeRatingModal(); 

                    // Show Toast SAU KHI modal ƒë√£ ƒë√≥ng (ch·ªù 0.6s)
                    setTimeout(() => { 
                        showToast(toastMessage);
                    }, 600); 

                } catch (error) {
                    console.error("L·ªói khi l∆∞u ƒë√°nh gi√° v√†o Firebase:", error);
                    showToast("L·ªói! Kh√¥ng th·ªÉ l∆∞u ƒë√°nh gi√°. Vui l√≤ng th·ª≠ l·∫°i.");
                    allStars.forEach(star => star.style.pointerEvents = 'auto'); // K√≠ch ho·∫°t l·∫°i n·∫øu l·ªói x·∫£y ra
                }
                
            } else if (rating === 1) {
                // --- TR∆Ø·ªúNG H·ª¢P KH√îNG H√ÄI L√íNG (FROWN - 1 sao): HI·ªÜN FORM FEEDBACK ---
                
                // ·∫®n prompt v√† khu v·ª±c icon sau khi animation n·∫£y k·∫øt th√∫c
                setTimeout(() => {
                    ratingPrompt.style.display = 'none';
                    dynamicRatingStarsContainer.style.display = 'none'; // ·∫®n ho√†n to√†n khu v·ª±c icon
                    
                    // Hi·ªán khu v·ª±c feedback
                    employeeFeedbackArea.style.display = 'block';
                    employeeFeedbackTextarea.focus();
                    
                    selectedIconElement.classList.remove('star-bounce'); 
                    
                    allStars.forEach(star => star.style.pointerEvents = 'auto'); // K√≠ch ho·∫°t l·∫°i c√°c icon ƒë√£ b·ªã v√¥ hi·ªáu h√≥a
                    
                }, 500); 

            }
        }

        // --- H√ÄM SUBMIT FEEDBACK C·ª§ TH·ªÇ CHO NH√ÇN VI√äN (M·ªöI) ---
        window.submitEmployeeFeedback = async function() {
            const feedback = employeeFeedbackTextarea.value.trim();
            // L·∫•y icon cu·ªëi c√πng ƒë∆∞·ª£c ch·ªçn (M·∫∑t Bu·ªìn)
            const selectedStar = dynamicRatingStarsContainer.querySelector('.rating-star.last-selected');
            
            if (feedback === "") {
                showToast("Vui l√≤ng nh·∫≠p n·ªôi dung g√≥p √Ω c·ª• th·ªÉ.");
                employeeFeedbackTextarea.focus();
                return;
            }
            
            if (!selectedStar || selectedStar.getAttribute('data-rating') !== '1') {
                showToast("L·ªói: Kh√¥ng t√¨m th·∫•y m·ª©c ƒë√°nh gi√° 1 sao. Vui l√≤ng th·ª≠ l·∫°i.");
                closeEmployeeRatingModal();
                return;
            }
            
            const rating = 1;
            const mood = 'Kh√¥ng H√†i L√≤ng';

            try {
                const data = {
                    employeeId: currentRatingEmployee.employeeId,
                    employeeName: currentRatingEmployee.employeeName,
                    employeeRole: currentRatingEmployee.employeeRole,
                    rating: rating,
                    mood: mood,
                    feedbackText: feedback, // L∆ØU TEXT C·ª§ TH·ªÇ
                    timestamp: Date.now(), 
                    vnTime: getVietnamTime(), 
                    userId: userId,
                    tableNumber: tableNumber
                };
                
                const ratingsRef = ref(db, `ratings`);
                await push(ratingsRef, data); 

                const toastMessage = `G√≥p √Ω c·ªßa b·∫°n v·ªÅ ${currentRatingEmployee.employeeName} ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n. C·∫£m ∆°n b·∫°n!`;

                // 1. Reset v√† ƒê√≥ng modal
                employeeFeedbackTextarea.value = '';
                closeEmployeeRatingModal(); 

                // 2. Show Toast SAU KHI modal ƒë√£ ƒë√≥ng (ch·ªù 0.6s)
                setTimeout(() => { 
                    showToast(toastMessage);
                }, 600);

            } catch (error) {
                console.error("L·ªói khi l∆∞u g√≥p √Ω nh√¢n vi√™n v√†o Firebase:", error);
                showToast("L·ªói! Kh√¥ng th·ªÉ g·ª≠i g√≥p √Ω. Vui l√≤ng th·ª≠ l·∫°i.");
            }
        }


        // --- H√ÄM G·ª¨I G√ìP √ù CHUNG V√Ä L∆ØU V√ÄO DB (Gi·ªØ nguy√™n) ---
        window.submitFeedback = async function() {
            const feedback = feedbackTextarea.value.trim();

            if (feedback === "") {
                showToast("Vui l√≤ng nh·∫≠p n·ªôi dung g√≥p √Ω tr∆∞·ªõc khi g·ª≠i!");
                return;
            }

            // FIREBASE LOGIC: L∆∞u g√≥p √Ω
            try {
                const data = {
                    feedback: feedback,
                    timestamp: Date.now(),
                    vnTime: getVietnamTime(),
                    userId: userId,
                    tableNumber: tableNumber 
                };
                
                const feedbackRef = ref(db, 'general_feedback');
                await push(feedbackRef, data); 

                console.log("N·ªôi dung g√≥p √Ω ƒë√£ ƒë∆∞·ª£c l∆∞u:", feedback);
                showToast(`G√≥p √Ω c·ªßa qu√Ω kh√°ch t·∫°i b√†n ${tableNumber} ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n. Xin ch√¢n th√†nh c·∫£m ∆°n!`);
                
                feedbackTextarea.value = '';
                closeFeedbackModal();

            } catch (error) {
                console.error("L·ªói khi l∆∞u g√≥p √Ω v√†o Firebase:", error);
                showToast("L·ªói! Kh√¥ng th·ªÉ g·ª≠i g√≥p √Ω. Vui l√≤ng th·ª≠ l·∫°i.");
            }
        }

        // ƒê√≥ng modal khi click ra ngo√†i khung n·ªôi dung (C·∫≠p nh·∫≠t ƒë·ªÉ bao g·ªìm c·∫£ 2 modal)
        window.onclick = function(event) {
            if (event.target == feedbackModal) {
                window.closeFeedbackModal();
            }
            if (event.target == employeeRatingModal) {
                window.closeEmployeeRatingModal();
            }
        }

        // --- LOGIC C·∫¨P NH·∫¨T: ANIMATION HI·ªÇN TH·ªä T·ª™NG PH·∫¶N R·∫§T CH·∫¨M V√Ä TU·∫¶N T·ª∞ (STAGGERED) ---
        document.addEventListener('DOMContentLoaded', () => {
            const header = document.querySelector('.app-header');
            const employeeCards = document.querySelectorAll('.employee-card'); // L·∫•y t·ª´ng th·∫ª nh√¢n vi√™n
            
            // Danh s√°ch c√°c ph·∫ßn t·ª≠ c·∫ßn hi·ªÉn th·ªã tu·∫ßn t·ª± (Ch·ªâ c√≤n Header -> T·ª´ng th·∫ª nh√¢n vi√™n)
            // N√∫t G√≥p √ù ƒë√£ ƒë∆∞·ª£c lo·∫°i b·ªè kh·ªèi danh s√°ch n√†y ƒë·ªÉ hi·ªÉn th·ªã ngay l·∫≠p t·ª©c.
            const elements = [header, ...Array.from(employeeCards)]; 
            
            let delay = 0;
            const delayIncrement = 200; // 200ms delay gi·ªØa m·ªói ph·∫ßn t·ª≠

            elements.forEach(el => {
                if (el) {
                    setTimeout(() => {
                        el.classList.add('show');
                    }, delay);
                    // TƒÉng ƒë·ªô tr·ªÖ cho ph·∫ßn t·ª≠ ti·∫øp theo
                    delay += delayIncrement;
                }
            });
        });
        
    </script>
</body>
</html>
